"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2705],{99416:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=t(85893),r=t(11151);const o={},s="Prompts",i={id:"guides/core-types/prompts",title:"Prompts",description:"Creating, evaluating, and refining prompts is a core activity for AI engineers.",source:"@site/docs/guides/core-types/prompts.md",sourceDirName:"guides/core-types",slug:"/guides/core-types/prompts",permalink:"/guides/core-types/prompts",draft:!1,unlisted:!1,editUrl:"https://github.com/wandb/weave/blob/master/docs/docs/guides/core-types/prompts.md",tags:[],version:"current",lastUpdatedAt:1730850471e3,frontMatter:{}},p={},l=[{value:"Getting started",id:"getting-started",level:2},{value:"Constructing prompts",id:"constructing-prompts",level:2},{value:"Parameterizing prompts",id:"parameterizing-prompts",level:2},{value:"Using prompts",id:"using-prompts",level:2},{value:"Publishing to server",id:"publishing-to-server",level:2},{value:"Retrieving from server",id:"retrieving-from-server",level:2},{value:"Loading and saving from files",id:"loading-and-saving-from-files",level:2},{value:"Evaluating prompts",id:"evaluating-prompts",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"prompts",children:"Prompts"}),"\n",(0,a.jsx)(n.p,{children:"Creating, evaluating, and refining prompts is a core activity for AI engineers.\nSmall changes to a prompt can have big impacts on your application's behavior.\nWeave lets you create prompts, save and retrieve them, and evolve them over time.\nSome of the benefits of Weave's prompt management system are:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Unopinionated core, with a batteries-included option for rapid development"}),"\n",(0,a.jsx)(n.li,{children:"Versioning that shows you how a prompt has evolved over time"}),"\n",(0,a.jsx)(n.li,{children:"The ability to update a prompt in production without redeploying your application"}),"\n",(0,a.jsx)(n.li,{children:"The ability to evaluate a prompt against many inputs to evaluate performance"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,a.jsxs)(n.p,{children:["If you want complete control over how a Prompt is constructed, you can subclass the base class, ",(0,a.jsx)(n.code,{children:"weave.Prompt"}),", ",(0,a.jsx)(n.code,{children:"weave.StringPrompt"}),", or ",(0,a.jsx)(n.code,{children:"weave.MessagesPrompt"})," and implement the corresponding ",(0,a.jsx)(n.code,{children:"format"})," method. When you publish one of these objects with ",(0,a.jsx)(n.code,{children:"weave.publish"}),', it will appear in your Weave project on the "Prompts" page.']}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"class Prompt(Object):\n    def format(self, **kwargs: Any) -> Any:\n        ...\n\nclass StringPrompt(Prompt):\n    def format(self, **kwargs: Any) -> str:\n        ...\n\nclass MessagesPrompt(Prompt):\n    def format(self, **kwargs: Any) -> list:\n        ...\n"})}),"\n",(0,a.jsxs)(n.p,{children:['Weave also includes a "batteries-included" class called ',(0,a.jsx)(n.code,{children:"EasyPrompt"})," that can be simpler to start with, especially if you are working with APIs that are similar to OpenAI. This document highlights the features you get with EasyPrompt."]}),"\n",(0,a.jsx)(n.h2,{id:"constructing-prompts",children:"Constructing prompts"}),"\n",(0,a.jsx)(n.p,{children:"You can think of the EasyPrompt object as a list of messages with associated roles, optional\nplaceholder variables, and an optional model configuration.\nBut constructing a prompt can be as simple as providing a single string:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt("What\'s 23 * 42?")\nassert prompt[0] == {"role": "user", "content": "What\'s 23 * 42?"}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["For terseness, the weave library aliases the ",(0,a.jsx)(n.code,{children:"EasyPrompt"})," class to ",(0,a.jsx)(n.code,{children:"P"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from weave import P\np = P("What\'s 23 * 42?")\n'})}),"\n",(0,a.jsxs)(n.p,{children:["It is common for a prompt to consist of multiple messages. Each message has an associated ",(0,a.jsx)(n.code,{children:"role"}),".\nIf the role is omitted, it defaults to ",(0,a.jsx)(n.code,{children:'"user"'}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Some common roles"})}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Role"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"system"}),(0,a.jsx)(n.td,{children:"System prompts provide high level instructions and can be used to set the behavior, knowledge, or persona of the AI."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"user"}),(0,a.jsx)(n.td,{children:"Represents input from a human user. (This is the default role.)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"assistant"}),(0,a.jsx)(n.td,{children:"Represents the AI's generated replies. Can be used for historical completions or to show examples."})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"For convenience, you can prefix a message string with one of these known roles:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt("system: Talk like a pirate")\nassert prompt[0] == {"role": "system", "content": "Talk like a pirate"}\n\n# An explicit role parameter takes precedence\nprompt = weave.EasyPrompt("system: Talk like a pirate", role="user")\nassert prompt[0] == {"role": "user", "content": "system: Talk like a pirate"}\n\n'})}),"\n",(0,a.jsx)(n.p,{children:"Messages can be appended to a prompt one-by-one:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt()\nprompt.append("You are an expert travel consultant.", role="system")\nprompt.append("Give me five ideas for top kid-friendly attractions in New Zealand.")\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Or you can append multiple messages at once, either with the ",(0,a.jsx)(n.code,{children:"append"})," method or with the ",(0,a.jsx)(n.code,{children:"Prompt"}),"\nconstructor, which is convenient for constructing a prompt from existing messages."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt()\nprompt.append([\n    {"role": "system", "content": "You are an expert travel consultant."},\n    "Give me five ideas for top kid-friendly attractions in New Zealand."\n])\n\n# Same\nprompt = weave.EasyPrompt([\n    {"role": "system", "content": "You are an expert travel consultant."},\n    "Give me five ideas for top kid-friendly attractions in New Zealand."\n])\n'})}),"\n",(0,a.jsxs)(n.p,{children:["The Prompt class is designed to be easily inserted into existing code.\nFor example, you can quickly wrap it around all of the arguments to the\nOpenAI chat completion ",(0,a.jsx)(n.code,{children:"create"})," call including its messages and model\nconfiguration. If you don't wrap the inputs, Weave's integration would still\ntrack all of the call's inputs, but it would not extract them as a separate\nversioned object. Having a separate Prompt object allows you to version\nthe prompt, easily filter calls by that version, etc."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from weave import init, P\nfrom openai import OpenAI\nclient = OpenAI()\n\n# Must specify a target project, otherwise the Weave code is a no-op\n# highlight-next-line\ninit("intro-example")\n\n# highlight-next-line\nresponse = client.chat.completions.create(P(\n  model="gpt-4o-mini",\n  messages=[\n    {"role": "user", "content": "What\'s 23 * 42?"}\n  ],\n  temperature=0.7,\n  max_tokens=64,\n  top_p=1\n# highlight-next-line\n))\n'})}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["Why this works: Weave's OpenAI integration wraps the OpenAI ",(0,a.jsx)(n.code,{children:"create"})," method to make it a Weave Op.\nWhen the Op is executed, the Prompt object in the input will get saved and associated with the Call.\nHowever, it will be replaced with the structure the ",(0,a.jsx)(n.code,{children:"create"})," method expects for the execution of the\nunderlying function."]})}),"\n",(0,a.jsx)(n.h2,{id:"parameterizing-prompts",children:"Parameterizing prompts"}),"\n",(0,a.jsx)(n.p,{children:'When specifying a prompt, you can include placeholders for values you want to fill in later. These placeholders are called "Parameters".\nParameters are indicated with curly braces. Here\'s a simple example:'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt("What\'s {A} + {B}?")\n'})}),"\n",(0,a.jsxs)(n.p,{children:['You will specify values for all of the parameters or "bind" them, when you ',(0,a.jsx)(n.a,{href:"#using-prompts",children:"use the prompt"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"require"})," method of Prompt allows you to associate parameters with restrictions that will be checked at bind time to detect programming errors."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt("What\'s {A} + 42?")\nprompt.require("A", type="int", min=0, max=100)\n\nprompt = weave.EasyPrompt("system: You are a {profession}")\nprompt.require("profession", oneof=(\'pirate\', \'cartoon mouse\', \'hungry dragon\'), default=\'pirate\')\n'})}),"\n",(0,a.jsx)(n.h2,{id:"using-prompts",children:"Using prompts"}),"\n",(0,a.jsxs)(n.p,{children:["You use a Prompt by converting it into a list of messages where all template placeholders have been filled in. You can bind a prompt to parameter values with the ",(0,a.jsx)(n.code,{children:"bind"})," method or by simply calling it as a function. Here's an example where the prompt has zero parameters."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\nprompt = weave.EasyPrompt("What\'s 23 * 42?")\nassert prompt() == prompt.bind() == [\n    {"role": "user", "content": "What\'s 23 * 42?"}\n]\n'})}),"\n",(0,a.jsx)(n.p,{children:"If a prompt has parameters, you would specify values for them when you use the prompt.\nParameter values can be passed in as a dictionary or as keyword arguments."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\nprompt = weave.EasyPrompt("What\'s {A} + {B}?")\nassert prompt(A=5, B="10") == prompt({"A": 5, "B": "10"})\n'})}),"\n",(0,a.jsx)(n.p,{children:"If any parameters are missing, they will be left unsubstituted in the output."}),"\n",(0,a.jsxs)(n.p,{children:["Here's a complete example of using a prompt with OpenAI. This example also uses ",(0,a.jsx)(n.a,{href:"/guides/integrations/openai",children:"Weave's OpenAI integration"})," to automatically log the prompt and response."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\nfrom openai import OpenAI\nclient = OpenAI()\n\nweave.init("intro-example")\nprompt = weave.EasyPrompt()\nprompt.append("You will be provided with a tweet, and your task is to classify its sentiment as positive, neutral, or negative.", role="system")\nprompt.append("I love {this_thing}!")\n\nresponse = client.chat.completions.create(\n  model="gpt-4o-mini",\n  messages=prompt(this_thing="Weave"),\n  temperature=0.7,\n  max_tokens=64,\n  top_p=1\n)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"publishing-to-server",children:"Publishing to server"}),"\n",(0,a.jsxs)(n.p,{children:["Prompt are a type of ",(0,a.jsx)(n.a,{href:"/guides/tracking/objects",children:"Weave object"}),", and use the same methods for publishing to the Weave server.\nYou must specify a destination project name with ",(0,a.jsx)(n.code,{children:"weave.init"})," before you can publish a prompt."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt()\nprompt.append("What\'s 23 * 42?")\n\nweave.init("intro-example") # Use entity/project format if not targeting your default entity\nweave.publish(prompt, name="calculation-prompt")\n'})}),"\n",(0,a.jsx)(n.p,{children:"Weave will automatically determine if the object has changed and only publish a new version if it has.\nYou can also specify a name or description for the Prompt as part of its constructor."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt(\n    "What\'s 23 * 42?",\n    name="calculation-prompt",\n    description="A prompt for calculating the product of two numbers.",\n)\n\nweave.init("intro-example")\nweave.publish(prompt)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"retrieving-from-server",children:"Retrieving from server"}),"\n",(0,a.jsxs)(n.p,{children:["Prompt are a type of ",(0,a.jsx)(n.a,{href:"/guides/tracking/objects",children:"Weave object"}),", and use the same methods for retrieval from the Weave server.\nYou must specify a source project name with ",(0,a.jsx)(n.code,{children:"weave.init"})," before you can retrieve a prompt."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nweave.init("intro-example")\nprompt = weave.ref("calculation-prompt").get()\n'})}),"\n",(0,a.jsx)(n.p,{children:"By default, the latest version of the prompt is returned. You can make this explicit or select a specific version by providing its version id."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nweave.init("intro-example")\nprompt = weave.ref("calculation-prompt:latest").get()\n# "<prompt_name>:<version_digest>", for example:\nprompt = weave.ref("calculation-prompt:QSLzr96CTzFwLWgFFi3EuawCI4oODz4Uax98SxIY79E").get()\n'})}),"\n",(0,a.jsxs)(n.p,{children:["It is also possible to retrieve a Prompt without calling ",(0,a.jsx)(n.code,{children:"init"})," if you pass a fully qualified URI to ",(0,a.jsx)(n.code,{children:"weave.ref"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"loading-and-saving-from-files",children:"Loading and saving from files"}),"\n",(0,a.jsx)(n.p,{children:"Prompts can be saved to files and loaded from files. This can be convenient if you want your Prompt to be versioned through\na mechanism other than Weave such as git, or as a fallback if Weave is not available."}),"\n",(0,a.jsxs)(n.p,{children:["To save a prompt to a file, you can use the ",(0,a.jsx)(n.code,{children:"dump_file"})," method."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt("What\'s 23 * 42?")\nprompt.dump_file("~/prompt.json")\n'})}),"\n",(0,a.jsxs)(n.p,{children:["and load it again later with ",(0,a.jsx)(n.code,{children:"Prompt.load_file"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import weave\n\nprompt = weave.EasyPrompt.load_file("~/prompt.json")\n'})}),"\n",(0,a.jsxs)(n.p,{children:["You can also use the lower level ",(0,a.jsx)(n.code,{children:"dump"})," and ",(0,a.jsx)(n.code,{children:"Prompt.load"})," methods for custom (de)serialization."]}),"\n",(0,a.jsx)(n.h2,{id:"evaluating-prompts",children:"Evaluating prompts"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.a,{href:"#parameterizing-prompts",children:"Parameter feature of prompts"})," can be used to execute or evaluate variations of a prompt."]}),"\n",(0,a.jsxs)(n.p,{children:["You can bind each row of a ",(0,a.jsx)(n.a,{href:"/guides/core-types/datasets",children:"Dataset"})," to generate N variations of a prompt."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import weave\n\n# Create a dataset\ndataset = weave.Dataset(name='countries', rows=[\n    {'id': '0', 'country': \"Argentina\"},\n    {'id': '1', 'country': \"Belize\"},\n    {'id': '2', 'country': \"Canada\"},\n    {'id': '3', 'country': \"New Zealand\"},\n])\n\nprompt = weave.EasyPrompt(name='travel_agent')\nprompt.append(\"You are an expert travel consultant.\", role=\"system\")\nprompt.append(\"Tell me the capital of {country} and about five kid-friendly attractions there.\")\n\n\nprompts = prompt.bind_rows(dataset)\nassert prompts[2][1][\"content\"] == \"Tell me the capital of Canada and about five kid-friendly attractions there.\"\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You can extend this into an ",(0,a.jsx)(n.a,{href:"/guides/core-types/evaluations",children:"Evaluation"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import asyncio\n\nimport openai\nimport weave\n\nweave.init(\"intro-example\")\n\n# Create a dataset\ndataset = weave.Dataset(name='countries', rows=[\n    {'id': '0', 'country': \"Argentina\", 'capital': \"Buenos Aires\"},\n    {'id': '1', 'country': \"Belize\", 'capital': \"Belmopan\"},\n    {'id': '2', 'country': \"Canada\", 'capital': \"Ottawa\"},\n    {'id': '3', 'country': \"New Zealand\", 'capital': \"Wellington\"},\n])\n\n# Create a prompt\nprompt = weave.EasyPrompt(name='travel_agent')\nprompt.append(\"You are an expert travel consultant.\", role=\"system\")\nprompt.append(\"Tell me the capital of {country} and about five kid-friendly attractions there.\")\n\n# Create a model, combining a prompt with model configuration\nclass TravelAgentModel(weave.Model):\n\n    model_name: str\n    prompt: weave.EasyPrompt\n\n    @weave.op\n    async def predict(self, country: str) -> dict:\n        client = openai.AsyncClient()\n\n        response = await client.chat.completions.create(\n            model=self.model_name,\n            messages=self.prompt(country=country),\n        )\n        result = response.choices[0].message.content\n        if result is None:\n            raise ValueError(\"No response from model\")\n        return result\n\n# Define and run the evaluation\n@weave.op\ndef mentions_capital_scorer(capital: str, model_output: str) -> dict:\n    return {'correct': capital in model_output}\n\nmodel = TravelAgentModel(model_name=\"gpt-4o-mini\", prompt=prompt)\nevaluation = weave.Evaluation(\n    dataset=dataset,\n    scorers=[mentions_capital_scorer],\n)\nasyncio.run(evaluation.evaluate(model))\n\n"})})]})}function d(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>i,a:()=>s});var a=t(67294);const r={},o=a.createContext(r);function s(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);