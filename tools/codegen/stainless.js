"use strict";var Po=Object.create;var Wr=Object.defineProperty;var Fo=Object.getOwnPropertyDescriptor;var Co=Object.getOwnPropertyNames;var vo=Object.getPrototypeOf,Bo=Object.prototype.hasOwnProperty;var Es=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var ko=(i,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Co(e))!Bo.call(i,r)&&r!==t&&Wr(i,r,{get:()=>e[r],enumerable:!(s=Fo(e,r))||s.enumerable});return i};var O=(i,e,t)=>(t=i!=null?Po(vo(i)):{},ko(e||!i||!i.__esModule?Wr(t,"default",{value:i,enumerable:!0}):t,i));var Gr=Es(gs=>{if(typeof require<"u")if(globalThis.crypto)gs.crypto=globalThis.crypto;else try{gs.crypto=[require][0]("node:crypto").webcrypto}catch{}});var nn=Es(()=>{if(typeof require<"u"&&!globalThis.File)try{globalThis.File=[require][0]("node:buffer").File}catch{}});var Ao=Es((lu,To)=>{"use strict";function Bh(i,e){var t=i;e.slice(0,-1).forEach(function(r){t=t[r]||{}});var s=e[e.length-1];return s in t}function Oo(i){return typeof i=="number"||/^0x[0-9a-f]+$/i.test(i)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(i)}function xo(i,e){return e==="constructor"&&typeof i[e]=="function"||e==="__proto__"}To.exports=function(i,e){e||(e={});var t={bools:{},strings:{},unknownFn:null};typeof e.unknown=="function"&&(t.unknownFn=e.unknown),typeof e.boolean=="boolean"&&e.boolean?t.allBools=!0:[].concat(e.boolean).filter(Boolean).forEach(function(y){t.bools[y]=!0});var s={};function r(y){return s[y].some(function(T){return t.bools[T]})}Object.keys(e.alias||{}).forEach(function(y){s[y]=[].concat(e.alias[y]),s[y].forEach(function(T){s[T]=[y].concat(s[y].filter(function(j){return T!==j}))})}),[].concat(e.string).filter(Boolean).forEach(function(y){t.strings[y]=!0,s[y]&&[].concat(s[y]).forEach(function(T){t.strings[T]=!0})});var n=e.default||{},o={_:[]};function a(y,T){return t.allBools&&/^--[^=]+$/.test(T)||t.strings[y]||t.bools[y]||s[y]}function h(y,T,j){for(var R=y,Ft=0;Ft<T.length-1;Ft++){var te=T[Ft];if(xo(R,te))return;R[te]===void 0&&(R[te]={}),(R[te]===Object.prototype||R[te]===Number.prototype||R[te]===String.prototype)&&(R[te]={}),R[te]===Array.prototype&&(R[te]=[]),R=R[te]}var ce=T[T.length-1];xo(R,ce)||((R===Object.prototype||R===Number.prototype||R===String.prototype)&&(R={}),R===Array.prototype&&(R=[]),R[ce]===void 0||t.bools[ce]||typeof R[ce]=="boolean"?R[ce]=j:Array.isArray(R[ce])?R[ce].push(j):R[ce]=[R[ce],j])}function l(y,T,j){if(!(j&&t.unknownFn&&!a(y,j)&&t.unknownFn(j)===!1)){var R=!t.strings[y]&&Oo(T)?Number(T):T;h(o,y.split("."),R),(s[y]||[]).forEach(function(Ft){h(o,Ft.split("."),R)})}}Object.keys(t.bools).forEach(function(y){l(y,n[y]===void 0?!1:n[y])});var c=[];i.indexOf("--")!==-1&&(c=i.slice(i.indexOf("--")+1),i=i.slice(0,i.indexOf("--")));for(var f=0;f<i.length;f++){var u=i[f],m,w;if(/^--.+=/.test(u)){var _=u.match(/^--([^=]+)=([\s\S]*)$/);m=_[1];var L=_[2];t.bools[m]&&(L=L!=="false"),l(m,L,u)}else if(/^--no-.+/.test(u))m=u.match(/^--no-(.+)/)[1],l(m,!1,u);else if(/^--.+/.test(u))m=u.match(/^--(.+)/)[1],w=i[f+1],w!==void 0&&!/^(-|--)[^-]/.test(w)&&!t.bools[m]&&!t.allBools&&(!s[m]||!r(m))?(l(m,w,u),f+=1):/^(true|false)$/.test(w)?(l(m,w==="true",u),f+=1):l(m,t.strings[m]?"":!0,u);else if(/^-[^-]+/.test(u)){for(var d=u.slice(1,-1).split(""),E=!1,S=0;S<d.length;S++){if(w=u.slice(S+2),w==="-"){l(d[S],w,u);continue}if(/[A-Za-z]/.test(d[S])&&w[0]==="="){l(d[S],w.slice(1),u),E=!0;break}if(/[A-Za-z]/.test(d[S])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(w)){l(d[S],w,u),E=!0;break}if(d[S+1]&&d[S+1].match(/\W/)){l(d[S],u.slice(S+2),u),E=!0;break}else l(d[S],t.strings[d[S]]?"":!0,u)}m=u.slice(-1)[0],!E&&m!=="-"&&(i[f+1]&&!/^(-|--)[^-]/.test(i[f+1])&&!t.bools[m]&&(!s[m]||!r(m))?(l(m,i[f+1],u),f+=1):i[f+1]&&/^(true|false)$/.test(i[f+1])?(l(m,i[f+1]==="true",u),f+=1):l(m,t.strings[m]?"":!0,u))}else if((!t.unknownFn||t.unknownFn(u)!==!1)&&o._.push(t.strings._||!Oo(u)?u:Number(u)),e.stopEarly){o._.push.apply(o._,i.slice(f+1));break}}return Object.keys(n).forEach(function(y){Bh(o,y.split("."))||(h(o,y.split("."),n[y]),(s[y]||[]).forEach(function(T){h(o,T.split("."),n[y])}))}),e["--"]?o["--"]=c.slice():c.forEach(function(y){o._.push(y)}),o}});var Kr=O(Gr(),1),mi=globalThis.crypto||Kr.crypto;function Vr(){return mi.randomUUID?mi.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,i=>(+i^mi.getRandomValues(new Uint8Array(1))[0]&15>>+i/4).toString(16))}var Ct=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null)try{return new Error(JSON.stringify(i))}catch{}return new Error(i)};var q=class extends Error{},C=class i extends q{constructor(e,t,s,r){super(`${i.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.error=t}static makeMessage(e,t,s){let r=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){if(!e||!r)return new Re({message:s,cause:Ct(t)});let n=t;return e===400?new at(e,n,s,r):e===401?new ht(e,n,s,r):e===403?new lt(e,n,s,r):e===404?new ct(e,n,s,r):e===409?new ft(e,n,s,r):e===422?new ut(e,n,s,r):e===429?new dt(e,n,s,r):e>=500?new mt(e,n,s,r):new i(e,n,s,r)}},Ue=class extends C{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Re=class extends C{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},ot=class extends Re{constructor({message:e}={}){super({message:e??"Request timed out."})}},at=class extends C{},ht=class extends C{},lt=class extends C{},ct=class extends C{},ft=class extends C{},ut=class extends C{},dt=class extends C{},mt=class extends C{};var Uo=/^[a-z][a-z0-9+.-]*:/i,jr=i=>Uo.test(i);function Ss(i){if(!i)return!0;for(let e in i)return!1;return!0}var qr=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new q(`${i} must be an integer`);if(e<0)throw new q(`${i} must be a positive integer`);return e};var Xr=i=>new Promise(e=>setTimeout(e,i));var _e="0.1.0-alpha.14";function zo(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"?"node":"unknown"}var Ho=()=>{let i=zo();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":Zr(Deno.build.os),"X-Stainless-Arch":Yr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":Zr(process.platform),"X-Stainless-Arch":Yr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let e=$o();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":_e,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function $o(){if(typeof navigator>"u"||!navigator)return null;let i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of i){let s=t.exec(navigator.userAgent);if(s){let r=s[1]||0,n=s[2]||0,o=s[3]||0;return{browser:e,version:`${r}.${n}.${o}`}}}return null}var Yr=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",Zr=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown"),Jr,Qr=()=>Jr??(Jr=Ho());function en(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Stainless({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function bs(i){return!!i&&i.readable===!0&&typeof i.read=="function"}function tn(i){return bs(i)&&"path"in i}function Wo(...i){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function sn(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return Wo({start(){},async pull(t){let{done:s,value:r}=await e.next();s?t.close():t.enqueue(r)},async cancel(){await e.return?.()}})}var rn=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var sl=O(nn(),1);var vt=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",an=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&vt(i),hn=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function",Vo=i=>an(i)||hn(i)||tn(i);function on(i,e,t){let s=globalThis.File;if(typeof s>"u")throw new Error("`File` is not defined as a global which is required for file uploads");return new s(i,e,t)}async function ze(i,e,t){if(i=await i,an(i))return i;if(hn(i)){let r=await i.blob();e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()??"unknown_file");let n=vt(r)?[await r.arrayBuffer()]:[r];return on(n,e,t)}let s=await jo(i);if(e||(e=Xo(i)??"unknown_file"),!t?.type){let r=s[0]?.type;typeof r=="string"&&(t={...t,type:r})}return on(s,e,t)}async function jo(i){let e=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)e.push(i);else if(vt(i))e.push(await i.arrayBuffer());else if(Yo(i))for await(let t of i)e.push(t);else throw new Error(`Unexpected data type: ${typeof i}; constructor: ${i?.constructor?.name}; props: ${qo(i)}`);return e}function qo(i){return`[${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}function Xo(i){return Rs(i.name)||Rs(i.filename)||Rs(i.path)?.split(/[\\/]/).pop()}var Rs=i=>{if(typeof i=="string")return i;if(typeof Buffer<"u"&&i instanceof Buffer)return String(i)},Yo=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";var Os=async i=>({...i,body:await ln(i.body)}),ln=async i=>{let e=new FormData;return await Promise.all(Object.entries(i||{}).map(([t,s])=>_s(e,t,s))),e};var _s=async(i,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")i.append(e,String(t));else if(Vo(t)){let s=await ze(t);i.append(e,s)}else if(Array.isArray(t))await Promise.all(t.map(s=>_s(i,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,r])=>_s(i,`${e}[${s}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var fn=Symbol("brand.privateNullableHeaders"),cn=Array.isArray;function*Jo(i){if(!i)return;if(fn in i){let{values:s,nulls:r}=i;yield*s.entries();for(let n of r)yield[n,null];return}let e=!1,t;i instanceof Headers?t=i.entries():cn(i)?t=i:(e=!0,t=Object.entries(i??{}));for(let s of t){let r=s[0],n=cn(s[1])?s[1]:[s[1]],o=!1;for(let a of n)a!==void 0&&(e&&!o&&(o=!0,yield[r,null]),yield[r,a])}}var xs=i=>{let e=new Headers,t=new Set,s=new Set;for(let r of i)for(let[n,o]of Jo(r)){let a=n.toLowerCase();s.has(a)||(e.delete(n),s.add(a)),o===null?(e.delete(n),t.add(a)):(e.append(n,o),t.delete(a))}return{[fn]:!0,values:e,nulls:t}};var pt=class{constructor(e){this._client=e}};var yt=class extends pt{retrieve(e,t,s){let{target:r}=t;return this._client.get(`/v1/builds/${e}/outputs/${r}`,s)}};var Oe=class extends pt{constructor(){super(...arguments),this.outputs=new yt(this._client)}create(e,t){return this._client.post("/api/spec",Os({body:e,...t,headers:{Accept:"*/*",...t?.headers}}))}list(e,t){return this._client.get("/v1/builds",{query:e,...t})}};Oe.Outputs=yt;var un={off:0,error:200,warn:300,info:400,debug:500};function ta(){}function pi(i,e,t){return!i||un[t]>un[e]?ta:i[t].bind(i)}var Ts,dn,mn;function He(i){let{logger:e,logLevel:t}=i;if(dn===t&&(e===Ts||e===Ts?.deref()))return mn;let s={error:pi(e,t,"error"),warn:pi(e,t,"warn"),info:pi(e,t,"info"),debug:pi(e,t,"debug")},{WeakRef:r}=globalThis;return Ts=e?r?new r(e):{deref:()=>e}:void 0,dn=t,mn=s,s}async function pn(i,e){let{response:t}=e;if(t.status===204)return null;if(e.options.__binaryResponse)return t;let s=t.headers.get("content-type");if(s?.includes("application/json")||s?.includes("application/vnd.api+json")){let o=await t.json();return He(i).debug("response",t.status,t.url,t.headers,o),o}let n=await t.text();return He(i).debug("response",t.status,t.url,t.headers,n),n}var ia=function(i,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},yn=function(i,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!s:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(i):s?s.value:e.get(i)},Bt,kt=class i extends Promise{constructor(e,t,s=pn){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=s,Bt.set(this,void 0),ia(this,Bt,e,"f")}_thenUnwrap(e){return new i(yn(this,Bt,"f"),this.responsePromise,async(t,s)=>e(await this.parseResponse(t,s),s))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(yn(this,Bt,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Bt=new WeakMap;var yi=i=>{if(typeof process<"u")return process.env?.[i]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(i)?.trim()};var sa=function(i,e,t,s,r){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?r.call(i,t):r?r.value=t:e.set(i,t),t},ra=function(i,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!s:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(i):s?s.value:e.get(i)},wn,wi,na=i=>{try{return JSON.parse(i)}catch{return}},oa=i=>i in{off:!0,error:!0,warn:!0,info:!0,debug:!0},A=class i{constructor({baseURL:e=yi("STAINLESS_BASE_URL"),apiKey:t=yi("API_KEY"),...s}={}){if(wi.set(this,void 0),this.builds=new Oe(this),t===void 0)throw new q("The API_KEY environment variable is missing or empty; either provide it, or instantiate the Stainless client with an apiKey option, like new Stainless({ apiKey: 'My API Key' }).");let r={apiKey:t,...s,baseURL:e||"https://api.stainlessapi.com"};if(this.baseURL=r.baseURL,this.timeout=r.timeout??i.DEFAULT_TIMEOUT,this.logger=r.logger??console,r.logLevel!=null)this.logLevel=r.logLevel;else{let n=yi("STAINLESS_LOG");oa(n)&&(this.logLevel=n)}this.httpAgent=r.httpAgent,this.maxRetries=r.maxRetries??2,this.fetch=r.fetch??en(),sa(this,wi,rn,"f"),this._options=r,this.apiKey=t}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return new Headers({Authorization:this.apiKey})}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new q(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${_e}`}defaultIdempotencyKey(){return`stainless-node-retry-${Vr()}`}makeStatusError(e,t,s,r){return C.generate(e,t,s,r)}buildURL(e,t){let s=jr(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Ss(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(async r=>{let n=r&&vt(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:n}}))}request(e,t=null){return new kt(this,this.makeRequest(e,t))}async makeRequest(e,t){let s=await e,r=s.maxRetries??this.maxRetries;t==null&&(t=r),await this.prepareOptions(s);let{req:n,url:o,timeout:a}=this.buildRequest(s,{retryCount:r-t});if(await this.prepareRequest(n,{url:o,options:s}),He(this).debug("request",o,s,n.headers),s.signal?.aborted)throw new Ue;let h=new AbortController,l=await this.fetchWithTimeout(o,n,a,h).catch(Ct);if(l instanceof Error){if(s.signal?.aborted)throw new Ue;if(t)return this.retryRequest(s,t);throw l.name==="AbortError"?new ot:new Re({cause:l})}if(!l.ok){if(t&&this.shouldRetry(l)){let _=`retrying, ${t} attempts remaining`;return He(this).debug(`response (error; ${_})`,l.status,o,l.headers),this.retryRequest(s,t,l.headers)}let c=await l.text().catch(_=>Ct(_).message),f=na(c),u=f?void 0:c,m=t?"(error; no more retries left)":"(error; not retryable)";throw He(this).debug(`response (error; ${m})`,l.status,o,l.headers,u),this.makeStatusError(l.status,f,u,l.headers)}return{response:l,options:s,controller:h}}async fetchWithTimeout(e,t,s,r){let{signal:n,method:o,...a}=t||{};n&&n.addEventListener("abort",()=>r.abort());let h=setTimeout(()=>r.abort(),s),l=bs(a.body),c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...a};return o&&(c.method=o.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(h)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s){let r,n=s?.get("retry-after-ms");if(n){let a=parseFloat(n);Number.isNaN(a)||(r=a)}let o=s?.get("retry-after");if(o&&!r){let a=parseFloat(o);Number.isNaN(a)?r=Date.parse(o)-Date.now():r=a*1e3}if(!(r&&0<=r&&r<60*1e3)){let a=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,a)}return await Xr(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let n=t-e,o=Math.min(.5*Math.pow(2,n),8),a=1-Math.random()*.25;return o*a*1e3}buildRequest(e,{retryCount:t=0}={}){let{method:s,path:r,query:n}=e,o=this.buildURL(r,n);"timeout"in e&&qr("timeout",e.timeout);let a=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent,l=a+1e3;typeof h?.options?.timeout=="number"&&l>(h.options.timeout??0)&&(h.options.timeout=l);let{bodyHeaders:c,body:f}=this.buildBody({options:e}),u=this.buildHeaders({options:e,method:s,bodyHeaders:c,retryCount:t});return{req:{method:s,headers:u,...h&&{agent:h},...e.signal&&{signal:e.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f}},url:o,timeout:a}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let n={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let o=xs([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...Qr()},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=xs([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:sn(e)}:ra(this,wi,"f").call(this,{body:e,headers:s})}};wn=A,wi=new WeakMap;A.Stainless=wn;A.DEFAULT_TIMEOUT=6e4;A.StainlessError=q;A.APIError=C;A.APIConnectionError=Re;A.APIConnectionTimeoutError=ot;A.APIUserAbortError=Ue;A.NotFoundError=ct;A.ConflictError=ft;A.RateLimitError=dt;A.BadRequestError=at;A.AuthenticationError=ht;A.InternalServerError=mt;A.PermissionDeniedError=lt;A.UnprocessableEntityError=ut;A.toFile=ze;A.Builds=Oe;var nt=O(require("fs")),zr=O(require("https")),Hr=require("zlib");var _n=O(require("events"),1),M=O(require("fs"),1);var Oi=require("node:events"),Fs=O(require("node:stream"),1),Rn=require("node:string_decoder"),En=typeof process=="object"&&process?process:{stdout:null,stderr:null},aa=i=>!!i&&typeof i=="object"&&(i instanceof U||i instanceof Fs.default||ha(i)||la(i)),ha=i=>!!i&&typeof i=="object"&&i instanceof Oi.EventEmitter&&typeof i.pipe=="function"&&i.pipe!==Fs.default.Writable.prototype.pipe,la=i=>!!i&&typeof i=="object"&&i instanceof Oi.EventEmitter&&typeof i.write=="function"&&typeof i.end=="function",fe=Symbol("EOF"),ue=Symbol("maybeEmitEnd"),xe=Symbol("emittedEnd"),Ei=Symbol("emittingEnd"),Mt=Symbol("emittedError"),gi=Symbol("closed"),gn=Symbol("read"),Si=Symbol("flush"),Sn=Symbol("flushChunk"),X=Symbol("encoding"),wt=Symbol("decoder"),D=Symbol("flowing"),Ut=Symbol("paused"),Et=Symbol("resume"),P=Symbol("buffer"),k=Symbol("pipes"),F=Symbol("bufferLength"),As=Symbol("bufferPush"),bi=Symbol("bufferShift"),v=Symbol("objectMode"),N=Symbol("destroyed"),Ls=Symbol("error"),Ns=Symbol("emitData"),bn=Symbol("emitEnd"),Is=Symbol("emitEnd2"),ie=Symbol("async"),Ds=Symbol("abort"),Ri=Symbol("aborted"),zt=Symbol("signal"),$e=Symbol("dataListeners"),H=Symbol("discarded"),Ht=i=>Promise.resolve().then(i),ca=i=>i(),fa=i=>i==="end"||i==="finish"||i==="prefinish",ua=i=>i instanceof ArrayBuffer||!!i&&typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,da=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),_i=class{src;dest;opts;ondrain;constructor(e,t,s){this.src=e,this.dest=t,this.opts=s,this.ondrain=()=>e[Et](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Ps=class extends _i{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,s){super(e,t,s),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}},ma=i=>!!i.objectMode,pa=i=>!i.objectMode&&!!i.encoding&&i.encoding!=="buffer",U=class extends Oi.EventEmitter{[D]=!1;[Ut]=!1;[k]=[];[P]=[];[v];[X];[ie];[wt];[fe]=!1;[xe]=!1;[Ei]=!1;[gi]=!1;[Mt]=null;[F]=0;[N]=!1;[zt];[Ri]=!1;[$e]=0;[H]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");ma(t)?(this[v]=!0,this[X]=null):pa(t)?(this[X]=t.encoding,this[v]=!1):(this[v]=!1,this[X]=null),this[ie]=!!t.async,this[wt]=this[X]?new Rn.StringDecoder(this[X]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[P]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[k]});let{signal:s}=t;s&&(this[zt]=s,s.aborted?this[Ds]():s.addEventListener("abort",()=>this[Ds]()))}get bufferLength(){return this[F]}get encoding(){return this[X]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[v]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[ie]}set async(e){this[ie]=this[ie]||!!e}[Ds](){this[Ri]=!0,this.emit("abort",this[zt]?.reason),this.destroy(this[zt]?.reason)}get aborted(){return this[Ri]}set aborted(e){}write(e,t,s){if(this[Ri])return!1;if(this[fe])throw new Error("write after end");if(this[N])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(s=t,t="utf8"),t||(t="utf8");let r=this[ie]?Ht:ca;if(!this[v]&&!Buffer.isBuffer(e)){if(da(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(ua(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[v]?(this[D]&&this[F]!==0&&this[Si](!0),this[D]?this.emit("data",e):this[As](e),this[F]!==0&&this.emit("readable"),s&&r(s),this[D]):e.length?(typeof e=="string"&&!(t===this[X]&&!this[wt]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[X]&&(e=this[wt].write(e)),this[D]&&this[F]!==0&&this[Si](!0),this[D]?this.emit("data",e):this[As](e),this[F]!==0&&this.emit("readable"),s&&r(s),this[D]):(this[F]!==0&&this.emit("readable"),s&&r(s),this[D])}read(e){if(this[N])return null;if(this[H]=!1,this[F]===0||e===0||e&&e>this[F])return this[ue](),null;this[v]&&(e=null),this[P].length>1&&!this[v]&&(this[P]=[this[X]?this[P].join(""):Buffer.concat(this[P],this[F])]);let t=this[gn](e||null,this[P][0]);return this[ue](),t}[gn](e,t){if(this[v])this[bi]();else{let s=t;e===s.length||e===null?this[bi]():typeof s=="string"?(this[P][0]=s.slice(e),t=s.slice(0,e),this[F]-=e):(this[P][0]=s.subarray(e),t=s.subarray(0,e),this[F]-=e)}return this.emit("data",t),!this[P].length&&!this[fe]&&this.emit("drain"),t}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t="utf8"),e!==void 0&&this.write(e,t),s&&this.once("end",s),this[fe]=!0,this.writable=!1,(this[D]||!this[Ut])&&this[ue](),this}[Et](){this[N]||(!this[$e]&&!this[k].length&&(this[H]=!0),this[Ut]=!1,this[D]=!0,this.emit("resume"),this[P].length?this[Si]():this[fe]?this[ue]():this.emit("drain"))}resume(){return this[Et]()}pause(){this[D]=!1,this[Ut]=!0,this[H]=!1}get destroyed(){return this[N]}get flowing(){return this[D]}get paused(){return this[Ut]}[As](e){this[v]?this[F]+=1:this[F]+=e.length,this[P].push(e)}[bi](){return this[v]?this[F]-=1:this[F]-=this[P][0].length,this[P].shift()}[Si](e=!1){do;while(this[Sn](this[bi]())&&this[P].length);!e&&!this[P].length&&!this[fe]&&this.emit("drain")}[Sn](e){return this.emit("data",e),this[D]}pipe(e,t){if(this[N])return e;this[H]=!1;let s=this[xe];return t=t||{},e===En.stdout||e===En.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,s?t.end&&e.end():(this[k].push(t.proxyErrors?new Ps(this,e,t):new _i(this,e,t)),this[ie]?Ht(()=>this[Et]()):this[Et]()),e}unpipe(e){let t=this[k].find(s=>s.dest===e);t&&(this[k].length===1?(this[D]&&this[$e]===0&&(this[D]=!1),this[k]=[]):this[k].splice(this[k].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let s=super.on(e,t);if(e==="data")this[H]=!1,this[$e]++,!this[k].length&&!this[D]&&this[Et]();else if(e==="readable"&&this[F]!==0)super.emit("readable");else if(fa(e)&&this[xe])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[Mt]){let r=t;this[ie]?Ht(()=>r.call(this,this[Mt])):r.call(this,this[Mt])}return s}removeListener(e,t){return this.off(e,t)}off(e,t){let s=super.off(e,t);return e==="data"&&(this[$e]=this.listeners("data").length,this[$e]===0&&!this[H]&&!this[k].length&&(this[D]=!1)),s}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[$e]=0,!this[H]&&!this[k].length&&(this[D]=!1)),t}get emittedEnd(){return this[xe]}[ue](){!this[Ei]&&!this[xe]&&!this[N]&&this[P].length===0&&this[fe]&&(this[Ei]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[gi]&&this.emit("close"),this[Ei]=!1)}emit(e,...t){let s=t[0];if(e!=="error"&&e!=="close"&&e!==N&&this[N])return!1;if(e==="data")return!this[v]&&!s?!1:this[ie]?(Ht(()=>this[Ns](s)),!0):this[Ns](s);if(e==="end")return this[bn]();if(e==="close"){if(this[gi]=!0,!this[xe]&&!this[N])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[Mt]=s,super.emit(Ls,s);let n=!this[zt]||this.listeners("error").length?super.emit("error",s):!1;return this[ue](),n}else if(e==="resume"){let n=super.emit("resume");return this[ue](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,...t);return this[ue](),r}[Ns](e){for(let s of this[k])s.dest.write(e)===!1&&this.pause();let t=this[H]?!1:super.emit("data",e);return this[ue](),t}[bn](){return this[xe]?!1:(this[xe]=!0,this.readable=!1,this[ie]?(Ht(()=>this[Is]()),!0):this[Is]())}[Is](){if(this[wt]){let t=this[wt].end();if(t){for(let s of this[k])s.dest.write(t);this[H]||super.emit("data",t)}}for(let t of this[k])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[v]||(e.dataLength=0);let t=this.promise();return this.on("data",s=>{e.push(s),this[v]||(e.dataLength+=s.length)}),await t,e}async concat(){if(this[v])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[X]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on(N,()=>t(new Error("stream destroyed"))),this.on("error",s=>t(s)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[H]=!1;let e=!1,t=async()=>(this.pause(),e=!0,{value:void 0,done:!0});return{next:()=>{if(e)return t();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[fe])return t();let n,o,a=f=>{this.off("data",h),this.off("end",l),this.off(N,c),t(),o(f)},h=f=>{this.off("error",a),this.off("end",l),this.off(N,c),this.pause(),n({value:f,done:!!this[fe]})},l=()=>{this.off("error",a),this.off("data",h),this.off(N,c),t(),n({done:!0,value:void 0})},c=()=>a(new Error("stream destroyed"));return new Promise((f,u)=>{o=u,n=f,this.once(N,c),this.once("error",a),this.once("end",l),this.once("data",h)})},throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[H]=!1;let e=!1,t=()=>(this.pause(),this.off(Ls,t),this.off(N,t),this.off("end",t),e=!0,{done:!0,value:void 0}),s=()=>{if(e)return t();let r=this.read();return r===null?t():{done:!1,value:r}};return this.once("end",t),this.once(Ls,t),this.once(N,t),{next:s,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[N])return e?this.emit("error",e):this.emit(N),this;this[N]=!0,this[H]=!0,this[P].length=0,this[F]=0;let t=this;return typeof t.close=="function"&&!this[gi]&&t.close(),e?this.emit("error",e):this.emit(N),this}static get isStream(){return aa}};var ya=M.default.writev,Ae=Symbol("_autoClose"),Z=Symbol("_close"),$t=Symbol("_ended"),b=Symbol("_fd"),Cs=Symbol("_finished"),me=Symbol("_flags"),vs=Symbol("_flush"),Us=Symbol("_handleChunk"),zs=Symbol("_makeBuf"),Gt=Symbol("_mode"),xi=Symbol("_needDrain"),bt=Symbol("_onerror"),Rt=Symbol("_onopen"),Bs=Symbol("_onread"),gt=Symbol("_onwrite"),Le=Symbol("_open"),Y=Symbol("_path"),Te=Symbol("_pos"),se=Symbol("_queue"),St=Symbol("_read"),ks=Symbol("_readSize"),de=Symbol("_reading"),Wt=Symbol("_remain"),Ms=Symbol("_size"),Ti=Symbol("_write"),We=Symbol("_writing"),Ai=Symbol("_defaultFlag"),Ge=Symbol("_errored"),Ke=class extends U{[Ge]=!1;[b];[Y];[ks];[de]=!1;[Ms];[Wt];[Ae];constructor(e,t){if(t=t||{},super(t),this.readable=!0,this.writable=!1,typeof e!="string")throw new TypeError("path must be a string");this[Ge]=!1,this[b]=typeof t.fd=="number"?t.fd:void 0,this[Y]=e,this[ks]=t.readSize||16*1024*1024,this[de]=!1,this[Ms]=typeof t.size=="number"?t.size:1/0,this[Wt]=this[Ms],this[Ae]=typeof t.autoClose=="boolean"?t.autoClose:!0,typeof this[b]=="number"?this[St]():this[Le]()}get fd(){return this[b]}get path(){return this[Y]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[Le](){M.default.open(this[Y],"r",(e,t)=>this[Rt](e,t))}[Rt](e,t){e?this[bt](e):(this[b]=t,this.emit("open",t),this[St]())}[zs](){return Buffer.allocUnsafe(Math.min(this[ks],this[Wt]))}[St](){if(!this[de]){this[de]=!0;let e=this[zs]();if(e.length===0)return process.nextTick(()=>this[Bs](null,0,e));M.default.read(this[b],e,0,e.length,null,(t,s,r)=>this[Bs](t,s,r))}}[Bs](e,t,s){this[de]=!1,e?this[bt](e):this[Us](t,s)&&this[St]()}[Z](){if(this[Ae]&&typeof this[b]=="number"){let e=this[b];this[b]=void 0,M.default.close(e,t=>t?this.emit("error",t):this.emit("close"))}}[bt](e){this[de]=!0,this[Z](),this.emit("error",e)}[Us](e,t){let s=!1;return this[Wt]-=e,e>0&&(s=super.write(e<t.length?t.subarray(0,e):t)),(e===0||this[Wt]<=0)&&(s=!1,this[Z](),super.end()),s}emit(e,...t){switch(e){case"prefinish":case"finish":return!1;case"drain":return typeof this[b]=="number"&&this[St](),!1;case"error":return this[Ge]?!1:(this[Ge]=!0,super.emit(e,...t));default:return super.emit(e,...t)}}},Li=class extends Ke{[Le](){let e=!0;try{this[Rt](null,M.default.openSync(this[Y],"r")),e=!1}finally{e&&this[Z]()}}[St](){let e=!0;try{if(!this[de]){this[de]=!0;do{let t=this[zs](),s=t.length===0?0:M.default.readSync(this[b],t,0,t.length,null);if(!this[Us](s,t))break}while(!0);this[de]=!1}e=!1}finally{e&&this[Z]()}}[Z](){if(this[Ae]&&typeof this[b]=="number"){let e=this[b];this[b]=void 0,M.default.closeSync(e),this.emit("close")}}},pe=class extends _n.default{readable=!1;writable=!0;[Ge]=!1;[We]=!1;[$t]=!1;[se]=[];[xi]=!1;[Y];[Gt];[Ae];[b];[Ai];[me];[Cs]=!1;[Te];constructor(e,t){t=t||{},super(t),this[Y]=e,this[b]=typeof t.fd=="number"?t.fd:void 0,this[Gt]=t.mode===void 0?438:t.mode,this[Te]=typeof t.start=="number"?t.start:void 0,this[Ae]=typeof t.autoClose=="boolean"?t.autoClose:!0;let s=this[Te]!==void 0?"r+":"w";this[Ai]=t.flags===void 0,this[me]=t.flags===void 0?s:t.flags,this[b]===void 0&&this[Le]()}emit(e,...t){if(e==="error"){if(this[Ge])return!1;this[Ge]=!0}return super.emit(e,...t)}get fd(){return this[b]}get path(){return this[Y]}[bt](e){this[Z](),this[We]=!0,this.emit("error",e)}[Le](){M.default.open(this[Y],this[me],this[Gt],(e,t)=>this[Rt](e,t))}[Rt](e,t){this[Ai]&&this[me]==="r+"&&e&&e.code==="ENOENT"?(this[me]="w",this[Le]()):e?this[bt](e):(this[b]=t,this.emit("open",t),this[We]||this[vs]())}end(e,t){return e&&this.write(e,t),this[$t]=!0,!this[We]&&!this[se].length&&typeof this[b]=="number"&&this[gt](null,0),this}write(e,t){return typeof e=="string"&&(e=Buffer.from(e,t)),this[$t]?(this.emit("error",new Error("write() after end()")),!1):this[b]===void 0||this[We]||this[se].length?(this[se].push(e),this[xi]=!0,!1):(this[We]=!0,this[Ti](e),!0)}[Ti](e){M.default.write(this[b],e,0,e.length,this[Te],(t,s)=>this[gt](t,s))}[gt](e,t){e?this[bt](e):(this[Te]!==void 0&&typeof t=="number"&&(this[Te]+=t),this[se].length?this[vs]():(this[We]=!1,this[$t]&&!this[Cs]?(this[Cs]=!0,this[Z](),this.emit("finish")):this[xi]&&(this[xi]=!1,this.emit("drain"))))}[vs](){if(this[se].length===0)this[$t]&&this[gt](null,0);else if(this[se].length===1)this[Ti](this[se].pop());else{let e=this[se];this[se]=[],ya(this[b],e,this[Te],(t,s)=>this[gt](t,s))}}[Z](){if(this[Ae]&&typeof this[b]=="number"){let e=this[b];this[b]=void 0,M.default.close(e,t=>t?this.emit("error",t):this.emit("close"))}}},_t=class extends pe{[Le](){let e;if(this[Ai]&&this[me]==="r+")try{e=M.default.openSync(this[Y],this[me],this[Gt])}catch(t){if(t?.code==="ENOENT")return this[me]="w",this[Le]();throw t}else e=M.default.openSync(this[Y],this[me],this[Gt]);this[Rt](null,e)}[Z](){if(this[Ae]&&typeof this[b]=="number"){let e=this[b];this[b]=void 0,M.default.closeSync(e),this.emit("close")}}[Ti](e){let t=!0;try{this[gt](null,M.default.writeSync(this[b],e,0,e.length,this[Te])),t=!1}finally{if(t)try{this[Z]()}catch{}}}};var pr=O(require("node:path"),1);var et=O(require("node:fs"),1),Ki=require("path");var wa=new Map([["C","cwd"],["f","file"],["z","gzip"],["P","preservePaths"],["U","unlink"],["strip-components","strip"],["stripComponents","strip"],["keep-newer","newer"],["keepNewer","newer"],["keep-newer-files","newer"],["keepNewerFiles","newer"],["k","keep"],["keep-existing","keep"],["keepExisting","keep"],["m","noMtime"],["no-mtime","noMtime"],["p","preserveOwner"],["L","follow"],["h","follow"],["onentry","onReadEntry"]]),On=i=>!!i.sync&&!!i.file,xn=i=>!i.sync&&!!i.file,Tn=i=>!!i.sync&&!i.file,An=i=>!i.sync&&!i.file;var Ln=i=>!!i.file;var Ea=i=>{let e=wa.get(i);return e||i},Kt=(i={})=>{if(!i)return{};let e={};for(let[t,s]of Object.entries(i)){let r=Ea(t);e[r]=s}return e.chmod===void 0&&e.noChmod===!1&&(e.chmod=!0),delete e.noChmod,e};var re=(i,e,t,s,r)=>Object.assign((n=[],o,a)=>{Array.isArray(n)&&(o=n,n={}),typeof o=="function"&&(a=o,o=void 0),o?o=Array.from(o):o=[];let h=Kt(n);if(r?.(h,o),On(h)){if(typeof a=="function")throw new TypeError("callback not supported for sync tar functions");return i(h,o)}else if(xn(h)){let l=e(h,o),c=a||void 0;return c?l.then(()=>c(),c):l}else if(Tn(h)){if(typeof a=="function")throw new TypeError("callback not supported for sync tar functions");return t(h,o)}else if(An(h)){if(typeof a=="function")throw new TypeError("callback only supported with file option");return s(h,o)}else throw new Error("impossible options??")},{syncFile:i,asyncFile:e,syncNoFile:t,asyncNoFile:s,validate:r});var Gn=require("events");var Ni=O(require("assert"),1),we=require("buffer");var Dn=O(require("zlib"),1);var Nn=O(require("zlib"),1),ga=Nn.default.constants||{ZLIB_VERNUM:4736},ye=Object.freeze(Object.assign(Object.create(null),{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,BROTLI_DECODE:8,BROTLI_ENCODE:9,Z_MIN_WINDOWBITS:8,Z_MAX_WINDOWBITS:15,Z_DEFAULT_WINDOWBITS:15,Z_MIN_CHUNK:64,Z_MAX_CHUNK:1/0,Z_DEFAULT_CHUNK:16384,Z_MIN_MEMLEVEL:1,Z_MAX_MEMLEVEL:9,Z_DEFAULT_MEMLEVEL:8,Z_MIN_LEVEL:-1,Z_MAX_LEVEL:9,Z_DEFAULT_LEVEL:-1,BROTLI_OPERATION_PROCESS:0,BROTLI_OPERATION_FLUSH:1,BROTLI_OPERATION_FINISH:2,BROTLI_OPERATION_EMIT_METADATA:3,BROTLI_MODE_GENERIC:0,BROTLI_MODE_TEXT:1,BROTLI_MODE_FONT:2,BROTLI_DEFAULT_MODE:0,BROTLI_MIN_QUALITY:0,BROTLI_MAX_QUALITY:11,BROTLI_DEFAULT_QUALITY:11,BROTLI_MIN_WINDOW_BITS:10,BROTLI_MAX_WINDOW_BITS:24,BROTLI_LARGE_MAX_WINDOW_BITS:30,BROTLI_DEFAULT_WINDOW:22,BROTLI_MIN_INPUT_BLOCK_BITS:16,BROTLI_MAX_INPUT_BLOCK_BITS:24,BROTLI_PARAM_MODE:0,BROTLI_PARAM_QUALITY:1,BROTLI_PARAM_LGWIN:2,BROTLI_PARAM_LGBLOCK:3,BROTLI_PARAM_DISABLE_LITERAL_CONTEXT_MODELING:4,BROTLI_PARAM_SIZE_HINT:5,BROTLI_PARAM_LARGE_WINDOW:6,BROTLI_PARAM_NPOSTFIX:7,BROTLI_PARAM_NDIRECT:8,BROTLI_DECODER_RESULT_ERROR:0,BROTLI_DECODER_RESULT_SUCCESS:1,BROTLI_DECODER_RESULT_NEEDS_MORE_INPUT:2,BROTLI_DECODER_RESULT_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_PARAM_DISABLE_RING_BUFFER_REALLOCATION:0,BROTLI_DECODER_PARAM_LARGE_WINDOW:1,BROTLI_DECODER_NO_ERROR:0,BROTLI_DECODER_SUCCESS:1,BROTLI_DECODER_NEEDS_MORE_INPUT:2,BROTLI_DECODER_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_NIBBLE:-1,BROTLI_DECODER_ERROR_FORMAT_RESERVED:-2,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_META_NIBBLE:-3,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_ALPHABET:-4,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_SAME:-5,BROTLI_DECODER_ERROR_FORMAT_CL_SPACE:-6,BROTLI_DECODER_ERROR_FORMAT_HUFFMAN_SPACE:-7,BROTLI_DECODER_ERROR_FORMAT_CONTEXT_MAP_REPEAT:-8,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_1:-9,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_2:-10,BROTLI_DECODER_ERROR_FORMAT_TRANSFORM:-11,BROTLI_DECODER_ERROR_FORMAT_DICTIONARY:-12,BROTLI_DECODER_ERROR_FORMAT_WINDOW_BITS:-13,BROTLI_DECODER_ERROR_FORMAT_PADDING_1:-14,BROTLI_DECODER_ERROR_FORMAT_PADDING_2:-15,BROTLI_DECODER_ERROR_FORMAT_DISTANCE:-16,BROTLI_DECODER_ERROR_DICTIONARY_NOT_SET:-19,BROTLI_DECODER_ERROR_INVALID_ARGUMENTS:-20,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MODES:-21,BROTLI_DECODER_ERROR_ALLOC_TREE_GROUPS:-22,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MAP:-25,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_1:-26,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_2:-27,BROTLI_DECODER_ERROR_ALLOC_BLOCK_TYPE_TREES:-30,BROTLI_DECODER_ERROR_UNREACHABLE:-31},ga));var In=we.Buffer.concat,Ve=Symbol("_superWrite"),Ot=class extends Error{code;errno;constructor(e){super("zlib: "+e.message),this.code=e.code,this.errno=e.errno,this.code||(this.code="ZLIB_ERROR"),this.message="zlib: "+e.message,Error.captureStackTrace(this,this.constructor)}get name(){return"ZlibError"}},$s=Symbol("flushFlag"),Ii=class extends U{#e=!1;#i=!1;#s;#n;#r;#t;#o;get sawError(){return this.#e}get handle(){return this.#t}get flushFlag(){return this.#s}constructor(e,t){if(!e||typeof e!="object")throw new TypeError("invalid options for ZlibBase constructor");super(e),this.#s=e.flush??0,this.#n=e.finishFlush??0,this.#r=e.fullFlushFlag??0;try{this.#t=new Dn.default[t](e)}catch(s){throw new Ot(s)}this.#o=s=>{this.#e||(this.#e=!0,this.close(),this.emit("error",s))},this.#t?.on("error",s=>this.#o(new Ot(s))),this.once("end",()=>this.close)}close(){this.#t&&(this.#t.close(),this.#t=void 0,this.emit("close"))}reset(){if(!this.#e)return(0,Ni.default)(this.#t,"zlib binding closed"),this.#t.reset?.()}flush(e){this.ended||(typeof e!="number"&&(e=this.#r),this.write(Object.assign(we.Buffer.alloc(0),{[$s]:e})))}end(e,t,s){return typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),e&&(t?this.write(e,t):this.write(e)),this.flush(this.#n),this.#i=!0,super.end(s)}get ended(){return this.#i}[Ve](e){return super.write(e)}write(e,t,s){if(typeof t=="function"&&(s=t,t="utf8"),typeof e=="string"&&(e=we.Buffer.from(e,t)),this.#e)return;(0,Ni.default)(this.#t,"zlib binding closed");let r=this.#t._handle,n=r.close;r.close=()=>{};let o=this.#t.close;this.#t.close=()=>{},we.Buffer.concat=l=>l;let a;try{let l=typeof e[$s]=="number"?e[$s]:this.#s;a=this.#t._processChunk(e,l),we.Buffer.concat=In}catch(l){we.Buffer.concat=In,this.#o(new Ot(l))}finally{this.#t&&(this.#t._handle=r,r.close=n,this.#t.close=o,this.#t.removeAllListeners("error"))}this.#t&&this.#t.on("error",l=>this.#o(new Ot(l)));let h;if(a)if(Array.isArray(a)&&a.length>0){let l=a[0];h=this[Ve](we.Buffer.from(l));for(let c=1;c<a.length;c++)h=this[Ve](a[c])}else h=this[Ve](we.Buffer.from(a));return s&&s(),h}},Di=class extends Ii{#e;#i;constructor(e,t){e=e||{},e.flush=e.flush||ye.Z_NO_FLUSH,e.finishFlush=e.finishFlush||ye.Z_FINISH,e.fullFlushFlag=ye.Z_FULL_FLUSH,super(e,t),this.#e=e.level,this.#i=e.strategy}params(e,t){if(!this.sawError){if(!this.handle)throw new Error("cannot switch params when binding is closed");if(!this.handle.params)throw new Error("not supported in this implementation");if(this.#e!==e||this.#i!==t){this.flush(ye.Z_SYNC_FLUSH),(0,Ni.default)(this.handle,"zlib binding closed");let s=this.handle.flush;this.handle.flush=(r,n)=>{typeof r=="function"&&(n=r,r=this.flushFlag),this.flush(r),n?.()};try{this.handle.params(e,t)}finally{this.handle.flush=s}this.handle&&(this.#e=e,this.#i=t)}}}};var Pi=class extends Di{#e;constructor(e){super(e,"Gzip"),this.#e=e&&!!e.portable}[Ve](e){return this.#e?(this.#e=!1,e[9]=255,super[Ve](e)):super[Ve](e)}};var Fi=class extends Di{constructor(e){super(e,"Unzip")}},Ci=class extends Ii{constructor(e,t){e=e||{},e.flush=e.flush||ye.BROTLI_OPERATION_PROCESS,e.finishFlush=e.finishFlush||ye.BROTLI_OPERATION_FINISH,e.fullFlushFlag=ye.BROTLI_OPERATION_FLUSH,super(e,t)}},vi=class extends Ci{constructor(e){super(e,"BrotliCompress")}},Bi=class extends Ci{constructor(e){super(e,"BrotliDecompress")}};var xt=class i{tail;head;length=0;static create(e=[]){return new i(e)}constructor(e=[]){for(let t of e)this.push(t)}*[Symbol.iterator](){for(let e=this.head;e;e=e.next)yield e.value}removeNode(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");let t=e.next,s=e.prev;return t&&(t.prev=s),s&&(s.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=s),this.length--,e.next=void 0,e.prev=void 0,e.list=void 0,t}unshiftNode(e){if(e===this.head)return;e.list&&e.list.removeNode(e);let t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}pushNode(e){if(e===this.tail)return;e.list&&e.list.removeNode(e);let t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}push(...e){for(let t=0,s=e.length;t<s;t++)Ra(this,e[t]);return this.length}unshift(...e){for(var t=0,s=e.length;t<s;t++)_a(this,e[t]);return this.length}pop(){if(!this.tail)return;let e=this.tail.value,t=this.tail;return this.tail=this.tail.prev,this.tail?this.tail.next=void 0:this.head=void 0,t.list=void 0,this.length--,e}shift(){if(!this.head)return;let e=this.head.value,t=this.head;return this.head=this.head.next,this.head?this.head.prev=void 0:this.tail=void 0,t.list=void 0,this.length--,e}forEach(e,t){t=t||this;for(let s=this.head,r=0;s;r++)e.call(t,s.value,r,this),s=s.next}forEachReverse(e,t){t=t||this;for(let s=this.tail,r=this.length-1;s;r--)e.call(t,s.value,r,this),s=s.prev}get(e){let t=0,s=this.head;for(;s&&t<e;t++)s=s.next;if(t===e&&s)return s.value}getReverse(e){let t=0,s=this.tail;for(;s&&t<e;t++)s=s.prev;if(t===e&&s)return s.value}map(e,t){t=t||this;let s=new i;for(let r=this.head;r;)s.push(e.call(t,r.value,this)),r=r.next;return s}mapReverse(e,t){t=t||this;var s=new i;for(let r=this.tail;r;)s.push(e.call(t,r.value,this)),r=r.prev;return s}reduce(e,t){let s,r=this.head;if(arguments.length>1)s=t;else if(this.head)r=this.head.next,s=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;r;n++)s=e(s,r.value,n),r=r.next;return s}reduceReverse(e,t){let s,r=this.tail;if(arguments.length>1)s=t;else if(this.tail)r=this.tail.prev,s=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(let n=this.length-1;r;n--)s=e(s,r.value,n),r=r.prev;return s}toArray(){let e=new Array(this.length);for(let t=0,s=this.head;s;t++)e[t]=s.value,s=s.next;return e}toArrayReverse(){let e=new Array(this.length);for(let t=0,s=this.tail;s;t++)e[t]=s.value,s=s.prev;return e}slice(e=0,t=this.length){t<0&&(t+=this.length),e<0&&(e+=this.length);let s=new i;if(t<e||t<0)return s;e<0&&(e=0),t>this.length&&(t=this.length);let r=this.head,n=0;for(n=0;r&&n<e;n++)r=r.next;for(;r&&n<t;n++,r=r.next)s.push(r.value);return s}sliceReverse(e=0,t=this.length){t<0&&(t+=this.length),e<0&&(e+=this.length);let s=new i;if(t<e||t<0)return s;e<0&&(e=0),t>this.length&&(t=this.length);let r=this.length,n=this.tail;for(;n&&r>t;r--)n=n.prev;for(;n&&r>e;r--,n=n.prev)s.push(n.value);return s}splice(e,t=0,...s){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);let r=this.head;for(let o=0;r&&o<e;o++)r=r.next;let n=[];for(let o=0;r&&o<t;o++)n.push(r.value),r=this.removeNode(r);r?r!==this.tail&&(r=r.prev):r=this.tail;for(let o of s)r=ba(this,r,o);return n}reverse(){let e=this.head,t=this.tail;for(let s=e;s;s=s.prev){let r=s.prev;s.prev=s.next,s.next=r}return this.head=t,this.tail=e,this}};function ba(i,e,t){let s=e,r=e?e.next:i.head,n=new Vt(t,s,r,i);return n.next===void 0&&(i.tail=n),n.prev===void 0&&(i.head=n),i.length++,n}function Ra(i,e){i.tail=new Vt(e,i.tail,void 0,i),i.head||(i.head=i.tail),i.length++}function _a(i,e){i.head=new Vt(e,void 0,i.head,i),i.tail||(i.tail=i.head),i.length++}var Vt=class{list;next;prev;value;constructor(e,t,s,r){this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=void 0,s?(s.prev=this,this.next=s):this.next=void 0}};var Xe=require("node:path");var Pn=(i,e)=>{if(Number.isSafeInteger(i))i<0?xa(i,e):Oa(i,e);else throw Error("cannot encode number outside of javascript safe integer range");return e},Oa=(i,e)=>{e[0]=128;for(var t=e.length;t>1;t--)e[t-1]=i&255,i=Math.floor(i/256)},xa=(i,e)=>{e[0]=255;var t=!1;i=i*-1;for(var s=e.length;s>1;s--){var r=i&255;i=Math.floor(i/256),t?e[s-1]=Cn(r):r===0?e[s-1]=0:(t=!0,e[s-1]=vn(r))}},Fn=i=>{let e=i[0],t=e===128?Aa(i.subarray(1,i.length)):e===255?Ta(i):null;if(t===null)throw Error("invalid base256 encoding");if(!Number.isSafeInteger(t))throw Error("parsed number outside of javascript safe integer range");return t},Ta=i=>{for(var e=i.length,t=0,s=!1,r=e-1;r>-1;r--){var n=Number(i[r]),o;s?o=Cn(n):n===0?o=n:(s=!0,o=vn(n)),o!==0&&(t-=o*Math.pow(256,e-r-1))}return t},Aa=i=>{for(var e=i.length,t=0,s=e-1;s>-1;s--){var r=Number(i[s]);r!==0&&(t+=r*Math.pow(256,e-s-1))}return t},Cn=i=>(255^i)&255,vn=i=>(255^i)+1&255;var ki=i=>Mi.has(i);var Mi=new Map([["0","File"],["","OldFile"],["1","Link"],["2","SymbolicLink"],["3","CharacterDevice"],["4","BlockDevice"],["5","Directory"],["6","FIFO"],["7","ContiguousFile"],["g","GlobalExtendedHeader"],["x","ExtendedHeader"],["A","SolarisACL"],["D","GNUDumpDir"],["I","Inode"],["K","NextFileHasLongLinkpath"],["L","NextFileHasLongPath"],["M","ContinuationFile"],["N","OldGnuLongPath"],["S","SparseFile"],["V","TapeVolumeHeader"],["X","OldExtendedHeader"]]),Bn=new Map(Array.from(Mi).map(i=>[i[1],i[0]]));var $=class{cksumValid=!1;needPax=!1;nullBlock=!1;block;path;mode;uid;gid;size;cksum;#e="Unsupported";linkpath;uname;gname;devmaj=0;devmin=0;atime;ctime;mtime;charset;comment;constructor(e,t=0,s,r){Buffer.isBuffer(e)?this.decode(e,t||0,s,r):e&&this.#i(e)}decode(e,t,s,r){if(t||(t=0),!e||!(e.length>=t+512))throw new Error("need 512 bytes for header");this.path=je(e,t,100),this.mode=Ne(e,t+100,8),this.uid=Ne(e,t+108,8),this.gid=Ne(e,t+116,8),this.size=Ne(e,t+124,12),this.mtime=Ws(e,t+136,12),this.cksum=Ne(e,t+148,12),r&&this.#i(r,!0),s&&this.#i(s);let n=je(e,t+156,1);if(ki(n)&&(this.#e=n||"0"),this.#e==="0"&&this.path.slice(-1)==="/"&&(this.#e="5"),this.#e==="5"&&(this.size=0),this.linkpath=je(e,t+157,100),e.subarray(t+257,t+265).toString()==="ustar\x0000")if(this.uname=je(e,t+265,32),this.gname=je(e,t+297,32),this.devmaj=Ne(e,t+329,8)??0,this.devmin=Ne(e,t+337,8)??0,e[t+475]!==0){let a=je(e,t+345,155);this.path=a+"/"+this.path}else{let a=je(e,t+345,130);a&&(this.path=a+"/"+this.path),this.atime=Ws(e,t+476,12),this.ctime=Ws(e,t+488,12)}let o=8*32;for(let a=t;a<t+148;a++)o+=e[a];for(let a=t+156;a<t+512;a++)o+=e[a];this.cksumValid=o===this.cksum,this.cksum===void 0&&o===8*32&&(this.nullBlock=!0)}#i(e,t=!1){Object.assign(this,Object.fromEntries(Object.entries(e).filter(([s,r])=>!(r==null||s==="path"&&t||s==="linkpath"&&t||s==="global"))))}encode(e,t=0){if(e||(e=this.block=Buffer.alloc(512)),this.#e==="Unsupported"&&(this.#e="0"),!(e.length>=t+512))throw new Error("need 512 bytes for header");let s=this.ctime||this.atime?130:155,r=Na(this.path||"",s),n=r[0],o=r[1];this.needPax=!!r[2],this.needPax=qe(e,t,100,n)||this.needPax,this.needPax=Ie(e,t+100,8,this.mode)||this.needPax,this.needPax=Ie(e,t+108,8,this.uid)||this.needPax,this.needPax=Ie(e,t+116,8,this.gid)||this.needPax,this.needPax=Ie(e,t+124,12,this.size)||this.needPax,this.needPax=Gs(e,t+136,12,this.mtime)||this.needPax,e[t+156]=this.#e.charCodeAt(0),this.needPax=qe(e,t+157,100,this.linkpath)||this.needPax,e.write("ustar\x0000",t+257,8),this.needPax=qe(e,t+265,32,this.uname)||this.needPax,this.needPax=qe(e,t+297,32,this.gname)||this.needPax,this.needPax=Ie(e,t+329,8,this.devmaj)||this.needPax,this.needPax=Ie(e,t+337,8,this.devmin)||this.needPax,this.needPax=qe(e,t+345,s,o)||this.needPax,e[t+475]!==0?this.needPax=qe(e,t+345,155,o)||this.needPax:(this.needPax=qe(e,t+345,130,o)||this.needPax,this.needPax=Gs(e,t+476,12,this.atime)||this.needPax,this.needPax=Gs(e,t+488,12,this.ctime)||this.needPax);let a=8*32;for(let h=t;h<t+148;h++)a+=e[h];for(let h=t+156;h<t+512;h++)a+=e[h];return this.cksum=a,Ie(e,t+148,8,this.cksum),this.cksumValid=!0,this.needPax}get type(){return this.#e==="Unsupported"?this.#e:Mi.get(this.#e)}get typeKey(){return this.#e}set type(e){let t=String(Bn.get(e));if(ki(t)||t==="Unsupported")this.#e=t;else if(ki(e))this.#e=e;else throw new TypeError("invalid entry type: "+e)}},Na=(i,e)=>{let s=i,r="",n,o=Xe.posix.parse(i).root||".";if(Buffer.byteLength(s)<100)n=[s,r,!1];else{r=Xe.posix.dirname(s),s=Xe.posix.basename(s);do Buffer.byteLength(s)<=100&&Buffer.byteLength(r)<=e?n=[s,r,!1]:Buffer.byteLength(s)>100&&Buffer.byteLength(r)<=e?n=[s.slice(0,99),r,!0]:(s=Xe.posix.join(Xe.posix.basename(r),s),r=Xe.posix.dirname(r));while(r!==o&&n===void 0);n||(n=[i.slice(0,99),"",!0])}return n},je=(i,e,t)=>i.subarray(e,e+t).toString("utf8").replace(/\0.*/,""),Ws=(i,e,t)=>Ia(Ne(i,e,t)),Ia=i=>i===void 0?void 0:new Date(i*1e3),Ne=(i,e,t)=>Number(i[e])&128?Fn(i.subarray(e,e+t)):Pa(i,e,t),Da=i=>isNaN(i)?void 0:i,Pa=(i,e,t)=>Da(parseInt(i.subarray(e,e+t).toString("utf8").replace(/\0.*$/,"").trim(),8)),Fa={12:8589934591,8:2097151},Ie=(i,e,t,s)=>s===void 0?!1:s>Fa[t]||s<0?(Pn(s,i.subarray(e,e+t)),!0):(Ca(i,e,t,s),!1),Ca=(i,e,t,s)=>i.write(va(s,t),e,t,"ascii"),va=(i,e)=>Ba(Math.floor(i).toString(8),e),Ba=(i,e)=>(i.length===e-1?i:new Array(e-i.length-1).join("0")+i+" ")+"\0",Gs=(i,e,t,s)=>s===void 0?!1:Ie(i,e,t,s.getTime()/1e3),ka=new Array(156).join("\0"),qe=(i,e,t,s)=>s===void 0?!1:(i.write(s+ka,e,t,"utf8"),s.length!==Buffer.byteLength(s)||s.length>t);var Mn=require("node:path");var De=class i{atime;mtime;ctime;charset;comment;gid;uid;gname;uname;linkpath;dev;ino;nlink;path;size;mode;global;constructor(e,t=!1){this.atime=e.atime,this.charset=e.charset,this.comment=e.comment,this.ctime=e.ctime,this.dev=e.dev,this.gid=e.gid,this.global=t,this.gname=e.gname,this.ino=e.ino,this.linkpath=e.linkpath,this.mtime=e.mtime,this.nlink=e.nlink,this.path=e.path,this.size=e.size,this.uid=e.uid,this.uname=e.uname}encode(){let e=this.encodeBody();if(e==="")return Buffer.allocUnsafe(0);let t=Buffer.byteLength(e),s=512*Math.ceil(1+t/512),r=Buffer.allocUnsafe(s);for(let n=0;n<512;n++)r[n]=0;new $({path:("PaxHeader/"+(0,Mn.basename)(this.path??"")).slice(0,99),mode:this.mode||420,uid:this.uid,gid:this.gid,size:t,mtime:this.mtime,type:this.global?"GlobalExtendedHeader":"ExtendedHeader",linkpath:"",uname:this.uname||"",gname:this.gname||"",devmaj:0,devmin:0,atime:this.atime,ctime:this.ctime}).encode(r),r.write(e,512,t,"utf8");for(let n=t+512;n<r.length;n++)r[n]=0;return r}encodeBody(){return this.encodeField("path")+this.encodeField("ctime")+this.encodeField("atime")+this.encodeField("dev")+this.encodeField("ino")+this.encodeField("nlink")+this.encodeField("charset")+this.encodeField("comment")+this.encodeField("gid")+this.encodeField("gname")+this.encodeField("linkpath")+this.encodeField("mtime")+this.encodeField("size")+this.encodeField("uid")+this.encodeField("uname")}encodeField(e){if(this[e]===void 0)return"";let t=this[e],s=t instanceof Date?t.getTime()/1e3:t,r=" "+(e==="dev"||e==="ino"||e==="nlink"?"SCHILY.":"")+e+"="+s+`
`,n=Buffer.byteLength(r),o=Math.floor(Math.log(n)/Math.log(10))+1;return n+o>=Math.pow(10,o)&&(o+=1),o+n+r}static parse(e,t,s=!1){return new i(Ma(Ua(e),t),s)}},Ma=(i,e)=>e?Object.assign({},e,i):i,Ua=i=>i.replace(/\n$/,"").split(`
`).reduce(za,Object.create(null)),za=(i,e)=>{let t=parseInt(e,10);if(t!==Buffer.byteLength(e)+1)return i;e=e.slice((t+" ").length);let s=e.split("="),r=s.shift();if(!r)return i;let n=r.replace(/^SCHILY\.(dev|ino|nlink)/,"$1"),o=s.join("=");return i[n]=/^([A-Z]+\.)?([mac]|birth|creation)time$/.test(n)?new Date(Number(o)*1e3):/^[0-9]+$/.test(o)?+o:o,i};var Ha=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,p=Ha!=="win32"?i=>i:i=>i&&i.replace(/\\/g,"/");var Tt=class extends U{extended;globalExtended;header;startBlockSize;blockRemain;remain;type;meta=!1;ignore=!1;path;mode;uid;gid;uname;gname;size=0;mtime;atime;ctime;linkpath;dev;ino;nlink;invalid=!1;absolute;unsupported=!1;constructor(e,t,s){switch(super({}),this.pause(),this.extended=t,this.globalExtended=s,this.header=e,this.remain=e.size??0,this.startBlockSize=512*Math.ceil(this.remain/512),this.blockRemain=this.startBlockSize,this.type=e.type,this.type){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":break;case"NextFileHasLongLinkpath":case"NextFileHasLongPath":case"OldGnuLongPath":case"GlobalExtendedHeader":case"ExtendedHeader":case"OldExtendedHeader":this.meta=!0;break;default:this.ignore=!0}if(!e.path)throw new Error("no path provided for tar.ReadEntry");this.path=p(e.path),this.mode=e.mode,this.mode&&(this.mode=this.mode&4095),this.uid=e.uid,this.gid=e.gid,this.uname=e.uname,this.gname=e.gname,this.size=this.remain,this.mtime=e.mtime,this.atime=e.atime,this.ctime=e.ctime,this.linkpath=e.linkpath?p(e.linkpath):void 0,this.uname=e.uname,this.gname=e.gname,t&&this.#e(t),s&&this.#e(s,!0)}write(e){let t=e.length;if(t>this.blockRemain)throw new Error("writing more to entry than is appropriate");let s=this.remain,r=this.blockRemain;return this.remain=Math.max(0,s-t),this.blockRemain=Math.max(0,r-t),this.ignore?!0:s>=t?super.write(e):super.write(e.subarray(0,s))}#e(e,t=!1){e.path&&(e.path=p(e.path)),e.linkpath&&(e.linkpath=p(e.linkpath)),Object.assign(this,Object.fromEntries(Object.entries(e).filter(([s,r])=>!(r==null||s==="path"&&t))))}};var Ye=(i,e,t,s={})=>{i.file&&(s.file=i.file),i.cwd&&(s.cwd=i.cwd),s.code=t instanceof Error&&t.code||e,s.tarCode=e,!i.strict&&s.recoverable!==!1?(t instanceof Error&&(s=Object.assign(t,s),t=t.message),i.emit("warn",e,t,s)):t instanceof Error?i.emit("error",Object.assign(t,s)):i.emit("error",Object.assign(new Error(`${e}: ${t}`),s))};var $a=1024*1024,Ks=Buffer.from([31,139]),G=Symbol("state"),Ze=Symbol("writeEntry"),Ee=Symbol("readEntry"),Vs=Symbol("nextEntry"),Un=Symbol("processEntry"),ne=Symbol("extendedHeader"),jt=Symbol("globalExtendedHeader"),Pe=Symbol("meta"),zn=Symbol("emitMeta"),x=Symbol("buffer"),ge=Symbol("queue"),Fe=Symbol("ended"),js=Symbol("emittedEnd"),Je=Symbol("emit"),I=Symbol("unzip"),Ui=Symbol("consumeChunk"),zi=Symbol("consumeChunkSub"),qs=Symbol("consumeBody"),Hn=Symbol("consumeMeta"),$n=Symbol("consumeHeader"),qt=Symbol("consuming"),Xs=Symbol("bufferConcat"),Hi=Symbol("maybeEnd"),At=Symbol("writing"),Ce=Symbol("aborted"),$i=Symbol("onDone"),Qe=Symbol("sawValidEntry"),Wi=Symbol("sawNullBlock"),Gi=Symbol("sawEOF"),Wn=Symbol("closeStream"),Wa=()=>!0,Se=class extends Gn.EventEmitter{file;strict;maxMetaEntrySize;filter;brotli;writable=!0;readable=!1;[ge]=new xt;[x];[Ee];[Ze];[G]="begin";[Pe]="";[ne];[jt];[Fe]=!1;[I];[Ce]=!1;[Qe];[Wi]=!1;[Gi]=!1;[At]=!1;[qt]=!1;[js]=!1;constructor(e={}){super(),this.file=e.file||"",this.on($i,()=>{(this[G]==="begin"||this[Qe]===!1)&&this.warn("TAR_BAD_ARCHIVE","Unrecognized archive format")}),e.ondone?this.on($i,e.ondone):this.on($i,()=>{this.emit("prefinish"),this.emit("finish"),this.emit("end")}),this.strict=!!e.strict,this.maxMetaEntrySize=e.maxMetaEntrySize||$a,this.filter=typeof e.filter=="function"?e.filter:Wa;let t=e.file&&(e.file.endsWith(".tar.br")||e.file.endsWith(".tbr"));this.brotli=!e.gzip&&e.brotli!==void 0?e.brotli:t?void 0:!1,this.on("end",()=>this[Wn]()),typeof e.onwarn=="function"&&this.on("warn",e.onwarn),typeof e.onReadEntry=="function"&&this.on("entry",e.onReadEntry)}warn(e,t,s={}){Ye(this,e,t,s)}[$n](e,t){this[Qe]===void 0&&(this[Qe]=!1);let s;try{s=new $(e,t,this[ne],this[jt])}catch(r){return this.warn("TAR_ENTRY_INVALID",r)}if(s.nullBlock)this[Wi]?(this[Gi]=!0,this[G]==="begin"&&(this[G]="header"),this[Je]("eof")):(this[Wi]=!0,this[Je]("nullBlock"));else if(this[Wi]=!1,!s.cksumValid)this.warn("TAR_ENTRY_INVALID","checksum failure",{header:s});else if(!s.path)this.warn("TAR_ENTRY_INVALID","path is required",{header:s});else{let r=s.type;if(/^(Symbolic)?Link$/.test(r)&&!s.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath required",{header:s});else if(!/^(Symbolic)?Link$/.test(r)&&!/^(Global)?ExtendedHeader$/.test(r)&&s.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath forbidden",{header:s});else{let n=this[Ze]=new Tt(s,this[ne],this[jt]);if(!this[Qe])if(n.remain){let o=()=>{n.invalid||(this[Qe]=!0)};n.on("end",o)}else this[Qe]=!0;n.meta?n.size>this.maxMetaEntrySize?(n.ignore=!0,this[Je]("ignoredEntry",n),this[G]="ignore",n.resume()):n.size>0&&(this[Pe]="",n.on("data",o=>this[Pe]+=o),this[G]="meta"):(this[ne]=void 0,n.ignore=n.ignore||!this.filter(n.path,n),n.ignore?(this[Je]("ignoredEntry",n),this[G]=n.remain?"ignore":"header",n.resume()):(n.remain?this[G]="body":(this[G]="header",n.end()),this[Ee]?this[ge].push(n):(this[ge].push(n),this[Vs]())))}}}[Wn](){queueMicrotask(()=>this.emit("close"))}[Un](e){let t=!0;if(!e)this[Ee]=void 0,t=!1;else if(Array.isArray(e)){let[s,...r]=e;this.emit(s,...r)}else this[Ee]=e,this.emit("entry",e),e.emittedEnd||(e.on("end",()=>this[Vs]()),t=!1);return t}[Vs](){do;while(this[Un](this[ge].shift()));if(!this[ge].length){let e=this[Ee];!e||e.flowing||e.size===e.remain?this[At]||this.emit("drain"):e.once("drain",()=>this.emit("drain"))}}[qs](e,t){let s=this[Ze];if(!s)throw new Error("attempt to consume body without entry??");let r=s.blockRemain??0,n=r>=e.length&&t===0?e:e.subarray(t,t+r);return s.write(n),s.blockRemain||(this[G]="header",this[Ze]=void 0,s.end()),n.length}[Hn](e,t){let s=this[Ze],r=this[qs](e,t);return!this[Ze]&&s&&this[zn](s),r}[Je](e,t,s){!this[ge].length&&!this[Ee]?this.emit(e,t,s):this[ge].push([e,t,s])}[zn](e){switch(this[Je]("meta",this[Pe]),e.type){case"ExtendedHeader":case"OldExtendedHeader":this[ne]=De.parse(this[Pe],this[ne],!1);break;case"GlobalExtendedHeader":this[jt]=De.parse(this[Pe],this[jt],!0);break;case"NextFileHasLongPath":case"OldGnuLongPath":{let t=this[ne]??Object.create(null);this[ne]=t,t.path=this[Pe].replace(/\0.*/,"");break}case"NextFileHasLongLinkpath":{let t=this[ne]||Object.create(null);this[ne]=t,t.linkpath=this[Pe].replace(/\0.*/,"");break}default:throw new Error("unknown meta: "+e.type)}}abort(e){this[Ce]=!0,this.emit("abort",e),this.warn("TAR_ABORT",e,{recoverable:!1})}write(e,t,s){if(typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8")),this[Ce])return s?.(),!1;if((this[I]===void 0||this.brotli===void 0&&this[I]===!1)&&e){if(this[x]&&(e=Buffer.concat([this[x],e]),this[x]=void 0),e.length<Ks.length)return this[x]=e,s?.(),!0;for(let a=0;this[I]===void 0&&a<Ks.length;a++)e[a]!==Ks[a]&&(this[I]=!1);let o=this.brotli===void 0;if(this[I]===!1&&o)if(e.length<512)if(this[Fe])this.brotli=!0;else return this[x]=e,s?.(),!0;else try{new $(e.subarray(0,512)),this.brotli=!1}catch{this.brotli=!0}if(this[I]===void 0||this[I]===!1&&this.brotli){let a=this[Fe];this[Fe]=!1,this[I]=this[I]===void 0?new Fi({}):new Bi({}),this[I].on("data",l=>this[Ui](l)),this[I].on("error",l=>this.abort(l)),this[I].on("end",()=>{this[Fe]=!0,this[Ui]()}),this[At]=!0;let h=!!this[I][a?"end":"write"](e);return this[At]=!1,s?.(),h}}this[At]=!0,this[I]?this[I].write(e):this[Ui](e),this[At]=!1;let n=this[ge].length?!1:this[Ee]?this[Ee].flowing:!0;return!n&&!this[ge].length&&this[Ee]?.once("drain",()=>this.emit("drain")),s?.(),n}[Xs](e){e&&!this[Ce]&&(this[x]=this[x]?Buffer.concat([this[x],e]):e)}[Hi](){if(this[Fe]&&!this[js]&&!this[Ce]&&!this[qt]){this[js]=!0;let e=this[Ze];if(e&&e.blockRemain){let t=this[x]?this[x].length:0;this.warn("TAR_BAD_ARCHIVE",`Truncated input (needed ${e.blockRemain} more bytes, only ${t} available)`,{entry:e}),this[x]&&e.write(this[x]),e.end()}this[Je]($i)}}[Ui](e){if(this[qt]&&e)this[Xs](e);else if(!e&&!this[x])this[Hi]();else if(e){if(this[qt]=!0,this[x]){this[Xs](e);let t=this[x];this[x]=void 0,this[zi](t)}else this[zi](e);for(;this[x]&&this[x]?.length>=512&&!this[Ce]&&!this[Gi];){let t=this[x];this[x]=void 0,this[zi](t)}this[qt]=!1}(!this[x]||this[Fe])&&this[Hi]()}[zi](e){let t=0,s=e.length;for(;t+512<=s&&!this[Ce]&&!this[Gi];)switch(this[G]){case"begin":case"header":this[$n](e,t),t+=512;break;case"ignore":case"body":t+=this[qs](e,t);break;case"meta":t+=this[Hn](e,t);break;default:throw new Error("invalid state: "+this[G])}t<s&&(this[x]?this[x]=Buffer.concat([e.subarray(t),this[x]]):this[x]=e.subarray(t))}end(e,t,s){return typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,t)),s&&this.once("finish",s),this[Ce]||(this[I]?(e&&this[I].write(e),this[I].end()):(this[Fe]=!0,this.brotli===void 0&&(e=e||Buffer.alloc(0)),e&&this.write(e),this[Hi]())),this}};var oe=i=>{let e=i.length-1,t=-1;for(;e>-1&&i.charAt(e)==="/";)t=e,e--;return t===-1?i:i.slice(0,t)};var Ga=i=>{let e=i.onReadEntry;i.onReadEntry=e?t=>{e(t),t.resume()}:t=>t.resume()},Ys=(i,e)=>{let t=new Map(e.map(n=>[oe(n),!0])),s=i.filter,r=(n,o="")=>{let a=o||(0,Ki.parse)(n).root||".",h;if(n===a)h=!1;else{let l=t.get(n);l!==void 0?h=l:h=r((0,Ki.dirname)(n),a)}return t.set(n,h),h};i.filter=s?(n,o)=>s(n,o)&&r(oe(n)):n=>r(oe(n))},Ka=i=>{let e=new Se(i),t=i.file,s;try{let r=et.default.statSync(t),n=i.maxReadSize||16*1024*1024;if(r.size<n)e.end(et.default.readFileSync(t));else{let o=0,a=Buffer.allocUnsafe(n);for(s=et.default.openSync(t,"r");o<r.size;){let h=et.default.readSync(s,a,0,n,o);o+=h,e.write(a.subarray(0,h))}e.end()}}finally{if(typeof s=="number")try{et.default.closeSync(s)}catch{}}},Va=(i,e)=>{let t=new Se(i),s=i.maxReadSize||16*1024*1024,r=i.file;return new Promise((o,a)=>{t.on("error",a),t.on("end",o),et.default.stat(r,(h,l)=>{if(h)a(h);else{let c=new Ke(r,{readSize:s,size:l.size});c.on("error",a),c.pipe(t)}})})},tt=re(Ka,Va,i=>new Se(i),i=>new Se(i),(i,e)=>{e?.length&&Ys(i,e),i.noResume||Ga(i)});var ei=O(require("fs"),1);var J=O(require("fs"),1);var tr=O(require("path"),1);var Zs=(i,e,t)=>(i&=4095,t&&(i=(i|384)&-19),e&&(i&256&&(i|=64),i&32&&(i|=8),i&4&&(i|=1)),i);var Vn=require("node:path"),{isAbsolute:ja,parse:Kn}=Vn.win32,Xt=i=>{let e="",t=Kn(i);for(;ja(i)||t.root;){let s=i.charAt(0)==="/"&&i.slice(0,4)!=="//?/"?"/":t.root;i=i.slice(s.length),e+=s,t=Kn(i)}return[e,i]};var Vi=["|","<",">","?",":"],Js=Vi.map(i=>String.fromCharCode(61440+i.charCodeAt(0))),qa=new Map(Vi.map((i,e)=>[i,Js[e]])),Xa=new Map(Js.map((i,e)=>[i,Vi[e]])),Qs=i=>Vi.reduce((e,t)=>e.split(t).join(qa.get(t)),i),jn=i=>Js.reduce((e,t)=>e.split(t).join(Xa.get(t)),i);var Qn=(i,e)=>e?(i=p(i).replace(/^\.(\/|$)/,""),oe(e)+"/"+i):p(i),Ya=16*1024*1024,Xn=Symbol("process"),Yn=Symbol("file"),Zn=Symbol("directory"),ir=Symbol("symlink"),Jn=Symbol("hardlink"),Yt=Symbol("header"),ji=Symbol("read"),sr=Symbol("lstat"),qi=Symbol("onlstat"),rr=Symbol("onread"),nr=Symbol("onreadlink"),or=Symbol("openfile"),ar=Symbol("onopenfile"),ve=Symbol("close"),Xi=Symbol("mode"),hr=Symbol("awaitDrain"),er=Symbol("ondrain"),ae=Symbol("prefix"),Zt=class extends U{path;portable;myuid=process.getuid&&process.getuid()||0;myuser=process.env.USER||"";maxReadSize;linkCache;statCache;preservePaths;cwd;strict;mtime;noPax;noMtime;prefix;fd;blockLen=0;blockRemain=0;buf;pos=0;remain=0;length=0;offset=0;win32;absolute;header;type;linkpath;stat;onWriteEntry;#e=!1;constructor(e,t={}){let s=Kt(t);super(),this.path=p(e),this.portable=!!s.portable,this.maxReadSize=s.maxReadSize||Ya,this.linkCache=s.linkCache||new Map,this.statCache=s.statCache||new Map,this.preservePaths=!!s.preservePaths,this.cwd=p(s.cwd||process.cwd()),this.strict=!!s.strict,this.noPax=!!s.noPax,this.noMtime=!!s.noMtime,this.mtime=s.mtime,this.prefix=s.prefix?p(s.prefix):void 0,this.onWriteEntry=s.onWriteEntry,typeof s.onwarn=="function"&&this.on("warn",s.onwarn);let r=!1;if(!this.preservePaths){let[o,a]=Xt(this.path);o&&typeof a=="string"&&(this.path=a,r=o)}this.win32=!!s.win32||process.platform==="win32",this.win32&&(this.path=jn(this.path.replace(/\\/g,"/")),e=e.replace(/\\/g,"/")),this.absolute=p(s.absolute||tr.default.resolve(this.cwd,e)),this.path===""&&(this.path="./"),r&&this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:this,path:r+this.path});let n=this.statCache.get(this.absolute);n?this[qi](n):this[sr]()}warn(e,t,s={}){return Ye(this,e,t,s)}emit(e,...t){return e==="error"&&(this.#e=!0),super.emit(e,...t)}[sr](){J.default.lstat(this.absolute,(e,t)=>{if(e)return this.emit("error",e);this[qi](t)})}[qi](e){this.statCache.set(this.absolute,e),this.stat=e,e.isFile()||(e.size=0),this.type=Za(e),this.emit("stat",e),this[Xn]()}[Xn](){switch(this.type){case"File":return this[Yn]();case"Directory":return this[Zn]();case"SymbolicLink":return this[ir]();default:return this.end()}}[Xi](e){return Zs(e,this.type==="Directory",this.portable)}[ae](e){return Qn(e,this.prefix)}[Yt](){if(!this.stat)throw new Error("cannot write header before stat");this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.onWriteEntry?.(this),this.header=new $({path:this[ae](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[ae](this.linkpath):this.linkpath,mode:this[Xi](this.stat.mode),uid:this.portable?void 0:this.stat.uid,gid:this.portable?void 0:this.stat.gid,size:this.stat.size,mtime:this.noMtime?void 0:this.mtime||this.stat.mtime,type:this.type==="Unsupported"?void 0:this.type,uname:this.portable?void 0:this.stat.uid===this.myuid?this.myuser:"",atime:this.portable?void 0:this.stat.atime,ctime:this.portable?void 0:this.stat.ctime}),this.header.encode()&&!this.noPax&&super.write(new De({atime:this.portable?void 0:this.header.atime,ctime:this.portable?void 0:this.header.ctime,gid:this.portable?void 0:this.header.gid,mtime:this.noMtime?void 0:this.mtime||this.header.mtime,path:this[ae](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[ae](this.linkpath):this.linkpath,size:this.header.size,uid:this.portable?void 0:this.header.uid,uname:this.portable?void 0:this.header.uname,dev:this.portable?void 0:this.stat.dev,ino:this.portable?void 0:this.stat.ino,nlink:this.portable?void 0:this.stat.nlink}).encode());let e=this.header?.block;if(!e)throw new Error("failed to encode header");super.write(e)}[Zn](){if(!this.stat)throw new Error("cannot create directory entry without stat");this.path.slice(-1)!=="/"&&(this.path+="/"),this.stat.size=0,this[Yt](),this.end()}[ir](){J.default.readlink(this.absolute,(e,t)=>{if(e)return this.emit("error",e);this[nr](t)})}[nr](e){this.linkpath=p(e),this[Yt](),this.end()}[Jn](e){if(!this.stat)throw new Error("cannot create link entry without stat");this.type="Link",this.linkpath=p(tr.default.relative(this.cwd,e)),this.stat.size=0,this[Yt](),this.end()}[Yn](){if(!this.stat)throw new Error("cannot create file entry without stat");if(this.stat.nlink>1){let e=`${this.stat.dev}:${this.stat.ino}`,t=this.linkCache.get(e);if(t?.indexOf(this.cwd)===0)return this[Jn](t);this.linkCache.set(e,this.absolute)}if(this[Yt](),this.stat.size===0)return this.end();this[or]()}[or](){J.default.open(this.absolute,"r",(e,t)=>{if(e)return this.emit("error",e);this[ar](t)})}[ar](e){if(this.fd=e,this.#e)return this[ve]();if(!this.stat)throw new Error("should stat before calling onopenfile");this.blockLen=512*Math.ceil(this.stat.size/512),this.blockRemain=this.blockLen;let t=Math.min(this.blockLen,this.maxReadSize);this.buf=Buffer.allocUnsafe(t),this.offset=0,this.pos=0,this.remain=this.stat.size,this.length=this.buf.length,this[ji]()}[ji](){let{fd:e,buf:t,offset:s,length:r,pos:n}=this;if(e===void 0||t===void 0)throw new Error("cannot read file without first opening");J.default.read(e,t,s,r,n,(o,a)=>{if(o)return this[ve](()=>this.emit("error",o));this[rr](a)})}[ve](e=()=>{}){this.fd!==void 0&&J.default.close(this.fd,e)}[rr](e){if(e<=0&&this.remain>0){let r=Object.assign(new Error("encountered unexpected EOF"),{path:this.absolute,syscall:"read",code:"EOF"});return this[ve](()=>this.emit("error",r))}if(e>this.remain){let r=Object.assign(new Error("did not encounter expected EOF"),{path:this.absolute,syscall:"read",code:"EOF"});return this[ve](()=>this.emit("error",r))}if(!this.buf)throw new Error("should have created buffer prior to reading");if(e===this.remain)for(let r=e;r<this.length&&e<this.blockRemain;r++)this.buf[r+this.offset]=0,e++,this.remain++;let t=this.offset===0&&e===this.buf.length?this.buf:this.buf.subarray(this.offset,this.offset+e);this.write(t)?this[er]():this[hr](()=>this[er]())}[hr](e){this.once("drain",e)}write(e,t,s){if(typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8")),this.blockRemain<e.length){let r=Object.assign(new Error("writing more data than expected"),{path:this.absolute});return this.emit("error",r)}return this.remain-=e.length,this.blockRemain-=e.length,this.pos+=e.length,this.offset+=e.length,super.write(e,null,s)}[er](){if(!this.remain)return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),this[ve](e=>e?this.emit("error",e):this.end());if(!this.buf)throw new Error("buffer lost somehow in ONDRAIN");this.offset>=this.length&&(this.buf=Buffer.allocUnsafe(Math.min(this.blockRemain,this.buf.length)),this.offset=0),this.length=this.buf.length-this.offset,this[ji]()}},Yi=class extends Zt{sync=!0;[sr](){this[qi](J.default.lstatSync(this.absolute))}[ir](){this[nr](J.default.readlinkSync(this.absolute))}[or](){this[ar](J.default.openSync(this.absolute,"r"))}[ji](){let e=!0;try{let{fd:t,buf:s,offset:r,length:n,pos:o}=this;if(t===void 0||s===void 0)throw new Error("fd and buf must be set in READ method");let a=J.default.readSync(t,s,r,n,o);this[rr](a),e=!1}finally{if(e)try{this[ve](()=>{})}catch{}}}[hr](e){e()}[ve](e=()=>{}){this.fd!==void 0&&J.default.closeSync(this.fd),e()}},Zi=class extends U{blockLen=0;blockRemain=0;buf=0;pos=0;remain=0;length=0;preservePaths;portable;strict;noPax;noMtime;readEntry;type;prefix;path;mode;uid;gid;uname;gname;header;mtime;atime;ctime;linkpath;size;onWriteEntry;warn(e,t,s={}){return Ye(this,e,t,s)}constructor(e,t={}){let s=Kt(t);super(),this.preservePaths=!!s.preservePaths,this.portable=!!s.portable,this.strict=!!s.strict,this.noPax=!!s.noPax,this.noMtime=!!s.noMtime,this.onWriteEntry=s.onWriteEntry,this.readEntry=e;let{type:r}=e;if(r==="Unsupported")throw new Error("writing entry that should be ignored");this.type=r,this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.prefix=s.prefix,this.path=p(e.path),this.mode=e.mode!==void 0?this[Xi](e.mode):void 0,this.uid=this.portable?void 0:e.uid,this.gid=this.portable?void 0:e.gid,this.uname=this.portable?void 0:e.uname,this.gname=this.portable?void 0:e.gname,this.size=e.size,this.mtime=this.noMtime?void 0:s.mtime||e.mtime,this.atime=this.portable?void 0:e.atime,this.ctime=this.portable?void 0:e.ctime,this.linkpath=e.linkpath!==void 0?p(e.linkpath):void 0,typeof s.onwarn=="function"&&this.on("warn",s.onwarn);let n=!1;if(!this.preservePaths){let[a,h]=Xt(this.path);a&&typeof h=="string"&&(this.path=h,n=a)}this.remain=e.size,this.blockRemain=e.startBlockSize,this.onWriteEntry?.(this),this.header=new $({path:this[ae](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[ae](this.linkpath):this.linkpath,mode:this.mode,uid:this.portable?void 0:this.uid,gid:this.portable?void 0:this.gid,size:this.size,mtime:this.noMtime?void 0:this.mtime,type:this.type,uname:this.portable?void 0:this.uname,atime:this.portable?void 0:this.atime,ctime:this.portable?void 0:this.ctime}),n&&this.warn("TAR_ENTRY_INFO",`stripping ${n} from absolute path`,{entry:this,path:n+this.path}),this.header.encode()&&!this.noPax&&super.write(new De({atime:this.portable?void 0:this.atime,ctime:this.portable?void 0:this.ctime,gid:this.portable?void 0:this.gid,mtime:this.noMtime?void 0:this.mtime,path:this[ae](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[ae](this.linkpath):this.linkpath,size:this.size,uid:this.portable?void 0:this.uid,uname:this.portable?void 0:this.uname,dev:this.portable?void 0:this.readEntry.dev,ino:this.portable?void 0:this.readEntry.ino,nlink:this.portable?void 0:this.readEntry.nlink}).encode());let o=this.header?.block;if(!o)throw new Error("failed to encode header");super.write(o),e.pipe(this)}[ae](e){return Qn(e,this.prefix)}[Xi](e){return Zs(e,this.type==="Directory",this.portable)}write(e,t,s){typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8"));let r=e.length;if(r>this.blockRemain)throw new Error("writing more to entry than is appropriate");return this.blockRemain-=r,super.write(e,s)}end(e,t,s){return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,t??"utf8")),s&&this.once("finish",s),e?super.end(e,s):super.end(s),this}},Za=i=>i.isFile()?"File":i.isDirectory()?"Directory":i.isSymbolicLink()?"SymbolicLink":"Unsupported";var mr=O(require("path"),1);var ss=class{path;absolute;entry;stat;readdir;pending=!1;ignore=!1;piped=!1;constructor(e,t){this.path=e||"./",this.absolute=t}},eo=Buffer.alloc(1024),Ji=Symbol("onStat"),Jt=Symbol("ended"),Q=Symbol("queue"),Lt=Symbol("current"),it=Symbol("process"),Qt=Symbol("processing"),to=Symbol("processJob"),ee=Symbol("jobs"),lr=Symbol("jobDone"),Qi=Symbol("addFSEntry"),io=Symbol("addTarEntry"),ur=Symbol("stat"),dr=Symbol("readdir"),es=Symbol("onreaddir"),ts=Symbol("pipe"),so=Symbol("entry"),cr=Symbol("entryOpt"),is=Symbol("writeEntryClass"),ro=Symbol("write"),fr=Symbol("ondrain"),Be=class extends U{opt;cwd;maxReadSize;preservePaths;strict;noPax;prefix;linkCache;statCache;file;portable;zip;readdirCache;noDirRecurse;follow;noMtime;mtime;filter;jobs;[is];onWriteEntry;[Q];[ee]=0;[Qt]=!1;[Jt]=!1;constructor(e={}){if(super(),this.opt=e,this.file=e.file||"",this.cwd=e.cwd||process.cwd(),this.maxReadSize=e.maxReadSize,this.preservePaths=!!e.preservePaths,this.strict=!!e.strict,this.noPax=!!e.noPax,this.prefix=p(e.prefix||""),this.linkCache=e.linkCache||new Map,this.statCache=e.statCache||new Map,this.readdirCache=e.readdirCache||new Map,this.onWriteEntry=e.onWriteEntry,this[is]=Zt,typeof e.onwarn=="function"&&this.on("warn",e.onwarn),this.portable=!!e.portable,e.gzip||e.brotli){if(e.gzip&&e.brotli)throw new TypeError("gzip and brotli are mutually exclusive");if(e.gzip&&(typeof e.gzip!="object"&&(e.gzip={}),this.portable&&(e.gzip.portable=!0),this.zip=new Pi(e.gzip)),e.brotli&&(typeof e.brotli!="object"&&(e.brotli={}),this.zip=new vi(e.brotli)),!this.zip)throw new Error("impossible");let t=this.zip;t.on("data",s=>super.write(s)),t.on("end",()=>super.end()),t.on("drain",()=>this[fr]()),this.on("resume",()=>t.resume())}else this.on("drain",this[fr]);this.noDirRecurse=!!e.noDirRecurse,this.follow=!!e.follow,this.noMtime=!!e.noMtime,e.mtime&&(this.mtime=e.mtime),this.filter=typeof e.filter=="function"?e.filter:()=>!0,this[Q]=new xt,this[ee]=0,this.jobs=Number(e.jobs)||4,this[Qt]=!1,this[Jt]=!1}[ro](e){return super.write(e)}add(e){return this.write(e),this}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t=void 0),e&&this.add(e),this[Jt]=!0,this[it](),s&&s(),this}write(e){if(this[Jt])throw new Error("write after end");return e instanceof Tt?this[io](e):this[Qi](e),this.flowing}[io](e){let t=p(mr.default.resolve(this.cwd,e.path));if(!this.filter(e.path,e))e.resume();else{let s=new ss(e.path,t);s.entry=new Zi(e,this[cr](s)),s.entry.on("end",()=>this[lr](s)),this[ee]+=1,this[Q].push(s)}this[it]()}[Qi](e){let t=p(mr.default.resolve(this.cwd,e));this[Q].push(new ss(e,t)),this[it]()}[ur](e){e.pending=!0,this[ee]+=1;let t=this.follow?"stat":"lstat";ei.default[t](e.absolute,(s,r)=>{e.pending=!1,this[ee]-=1,s?this.emit("error",s):this[Ji](e,r)})}[Ji](e,t){this.statCache.set(e.absolute,t),e.stat=t,this.filter(e.path,t)||(e.ignore=!0),this[it]()}[dr](e){e.pending=!0,this[ee]+=1,ei.default.readdir(e.absolute,(t,s)=>{if(e.pending=!1,this[ee]-=1,t)return this.emit("error",t);this[es](e,s)})}[es](e,t){this.readdirCache.set(e.absolute,t),e.readdir=t,this[it]()}[it](){if(!this[Qt]){this[Qt]=!0;for(let e=this[Q].head;e&&this[ee]<this.jobs;e=e.next)if(this[to](e.value),e.value.ignore){let t=e.next;this[Q].removeNode(e),e.next=t}this[Qt]=!1,this[Jt]&&!this[Q].length&&this[ee]===0&&(this.zip?this.zip.end(eo):(super.write(eo),super.end()))}}get[Lt](){return this[Q]&&this[Q].head&&this[Q].head.value}[lr](e){this[Q].shift(),this[ee]-=1,this[it]()}[to](e){if(!e.pending){if(e.entry){e===this[Lt]&&!e.piped&&this[ts](e);return}if(!e.stat){let t=this.statCache.get(e.absolute);t?this[Ji](e,t):this[ur](e)}if(e.stat&&!e.ignore){if(!this.noDirRecurse&&e.stat.isDirectory()&&!e.readdir){let t=this.readdirCache.get(e.absolute);if(t?this[es](e,t):this[dr](e),!e.readdir)return}if(e.entry=this[so](e),!e.entry){e.ignore=!0;return}e===this[Lt]&&!e.piped&&this[ts](e)}}}[cr](e){return{onwarn:(t,s,r)=>this.warn(t,s,r),noPax:this.noPax,cwd:this.cwd,absolute:e.absolute,preservePaths:this.preservePaths,maxReadSize:this.maxReadSize,strict:this.strict,portable:this.portable,linkCache:this.linkCache,statCache:this.statCache,noMtime:this.noMtime,mtime:this.mtime,prefix:this.prefix,onWriteEntry:this.onWriteEntry}}[so](e){this[ee]+=1;try{return new this[is](e.path,this[cr](e)).on("end",()=>this[lr](e)).on("error",s=>this.emit("error",s))}catch(t){this.emit("error",t)}}[fr](){this[Lt]&&this[Lt].entry&&this[Lt].entry.resume()}[ts](e){e.piped=!0,e.readdir&&e.readdir.forEach(r=>{let n=e.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[Qi](o+r)});let t=e.entry,s=this.zip;if(!t)throw new Error("cannot pipe without source");s?t.on("data",r=>{s.write(r)||t.pause()}):t.on("data",r=>{super.write(r)||t.pause()})}pause(){return this.zip&&this.zip.pause(),super.pause()}warn(e,t,s={}){Ye(this,e,t,s)}},st=class extends Be{sync=!0;constructor(e){super(e),this[is]=Yi}pause(){}resume(){}[ur](e){let t=this.follow?"statSync":"lstatSync";this[Ji](e,ei.default[t](e.absolute))}[dr](e){this[es](e,ei.default.readdirSync(e.absolute))}[ts](e){let t=e.entry,s=this.zip;if(e.readdir&&e.readdir.forEach(r=>{let n=e.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[Qi](o+r)}),!t)throw new Error("Cannot pipe without source");s?t.on("data",r=>{s.write(r)}):t.on("data",r=>{super[ro](r)})}};var Ja=(i,e)=>{let t=new st(i),s=new _t(i.file,{mode:i.mode||438});t.pipe(s),no(t,e)},Qa=(i,e)=>{let t=new Be(i),s=new pe(i.file,{mode:i.mode||438});t.pipe(s);let r=new Promise((n,o)=>{s.on("error",o),s.on("close",n),t.on("error",o)});return oo(t,e),r},no=(i,e)=>{e.forEach(t=>{t.charAt(0)==="@"?tt({file:pr.default.resolve(i.cwd,t.slice(1)),sync:!0,noResume:!0,onReadEntry:s=>i.add(s)}):i.add(t)}),i.end()},oo=async(i,e)=>{for(let t=0;t<e.length;t++){let s=String(e[t]);s.charAt(0)==="@"?await tt({file:pr.default.resolve(String(i.cwd),s.slice(1)),noResume:!0,onReadEntry:r=>{i.add(r)}}):i.add(s)}i.end()},eh=(i,e)=>{let t=new st(i);return no(t,e),t},th=(i,e)=>{let t=new Be(i);return oo(t,e),t},ih=re(Ja,Qa,eh,th,(i,e)=>{if(!e?.length)throw new TypeError("no paths specified to add to archive")});var Mr=O(require("node:fs"),1);var _o=O(require("node:assert"),1),kr=require("node:crypto"),g=O(require("node:fs"),1),le=O(require("node:path"),1);var yr=O(require("fs"),1),sh=process.env.__FAKE_PLATFORM__||process.platform,rh=sh==="win32",{O_CREAT:nh,O_TRUNC:oh,O_WRONLY:ah}=yr.default.constants,ao=Number(process.env.__FAKE_FS_O_FILENAME__)||yr.default.constants.UV_FS_O_FILEMAP||0,hh=rh&&!!ao,lh=512*1024,ch=ao|oh|nh|ah,wr=hh?i=>i<lh?ch:"w":()=>"w";var ti=O(require("node:fs"),1),Nt=O(require("node:path"),1),Er=(i,e,t)=>{try{return ti.default.lchownSync(i,e,t)}catch(s){if(s?.code!=="ENOENT")throw s}},rs=(i,e,t,s)=>{ti.default.lchown(i,e,t,r=>{s(r&&r?.code!=="ENOENT"?r:null)})},fh=(i,e,t,s,r)=>{if(e.isDirectory())gr(Nt.default.resolve(i,e.name),t,s,n=>{if(n)return r(n);let o=Nt.default.resolve(i,e.name);rs(o,t,s,r)});else{let n=Nt.default.resolve(i,e.name);rs(n,t,s,r)}},gr=(i,e,t,s)=>{ti.default.readdir(i,{withFileTypes:!0},(r,n)=>{if(r){if(r.code==="ENOENT")return s();if(r.code!=="ENOTDIR"&&r.code!=="ENOTSUP")return s(r)}if(r||!n.length)return rs(i,e,t,s);let o=n.length,a=null,h=l=>{if(!a){if(l)return s(a=l);if(--o===0)return rs(i,e,t,s)}};for(let l of n)fh(i,l,e,t,h)})},uh=(i,e,t,s)=>{e.isDirectory()&&Sr(Nt.default.resolve(i,e.name),t,s),Er(Nt.default.resolve(i,e.name),t,s)},Sr=(i,e,t)=>{let s;try{s=ti.default.readdirSync(i,{withFileTypes:!0})}catch(r){let n=r;if(n?.code==="ENOENT")return;if(n?.code==="ENOTDIR"||n?.code==="ENOTSUP")return Er(i,e,t);throw n}for(let r of s)uh(i,r,e,t);return Er(i,e,t)};var W=O(require("fs"),1);var br=require("path");var ke=require("fs"),K=i=>{if(!i)i={mode:511};else if(typeof i=="object")i={mode:511,...i};else if(typeof i=="number")i={mode:i};else if(typeof i=="string")i={mode:parseInt(i,8)};else throw new TypeError("invalid options argument");let e=i,t=i.fs||{};return i.mkdir=i.mkdir||t.mkdir||ke.mkdir,i.mkdirAsync=i.mkdirAsync?i.mkdirAsync:async(s,r)=>new Promise((n,o)=>e.mkdir(s,r,(a,h)=>a?o(a):n(h))),i.stat=i.stat||t.stat||ke.stat,i.statAsync=i.statAsync?i.statAsync:async s=>new Promise((r,n)=>e.stat(s,(o,a)=>o?n(o):r(a))),i.statSync=i.statSync||t.statSync||ke.statSync,i.mkdirSync=i.mkdirSync||t.mkdirSync||ke.mkdirSync,e};var he=(i,e,t)=>{let s=(0,br.dirname)(i),r={...K(e),recursive:!1};if(s===i)try{return r.mkdirSync(i,r)}catch(n){let o=n;if(o&&o.code!=="EISDIR")throw n;return}try{return r.mkdirSync(i,r),t||i}catch(n){let o=n;if(o&&o.code==="ENOENT")return he(i,r,he(s,r,t));if(o&&o.code!=="EEXIST"&&o&&o.code!=="EROFS")throw n;try{if(!r.statSync(i).isDirectory())throw n}catch{throw n}}},be=Object.assign(async(i,e,t)=>{let s=K(e);s.recursive=!1;let r=(0,br.dirname)(i);return r===i?s.mkdirAsync(i,s).catch(n=>{let o=n;if(o&&o.code!=="EISDIR")throw n}):s.mkdirAsync(i,s).then(()=>t||i,async n=>{let o=n;if(o&&o.code==="ENOENT")return be(r,s).then(a=>be(i,s,a));if(o&&o.code!=="EEXIST"&&o.code!=="EROFS")throw n;return s.statAsync(i).then(a=>{if(a.isDirectory())return t;throw n},()=>{throw n})})},{sync:he});var xr=require("path");var Rr=require("path"),_r=async(i,e,t)=>{if(t!==e)return i.statAsync(e).then(s=>s.isDirectory()?t:void 0,s=>{let r=s;return r&&r.code==="ENOENT"?_r(i,(0,Rr.dirname)(e),e):void 0})},Or=(i,e,t)=>{if(t!==e)try{return i.statSync(e).isDirectory()?t:void 0}catch(s){let r=s;return r&&r.code==="ENOENT"?Or(i,(0,Rr.dirname)(e),e):void 0}};var It=(i,e)=>{let t=K(e);if(t.recursive=!0,(0,xr.dirname)(i)===i)return t.mkdirSync(i,t);let r=Or(t,i);try{return t.mkdirSync(i,t),r}catch(n){let o=n;if(o&&o.code==="ENOENT")return he(i,t);throw n}},ii=Object.assign(async(i,e)=>{let t={...K(e),recursive:!0};return(0,xr.dirname)(i)===i?await t.mkdirAsync(i,t):_r(t,i).then(r=>t.mkdirAsync(i,t).then(n=>r||n).catch(n=>{let o=n;if(o&&o.code==="ENOENT")return be(i,t);throw n}))},{sync:It});var ns=require("path"),dh=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,Tr=i=>{if(/\0/.test(i))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:i,code:"ERR_INVALID_ARG_VALUE"});if(i=(0,ns.resolve)(i),dh==="win32"){let e=/[*|"<>?:]/,{root:t}=(0,ns.parse)(i);if(e.test(i.substring(t.length)))throw Object.assign(new Error("Illegal characters in path."),{path:i,code:"EINVAL"})}return i};var os=require("fs");var mh=process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version,Ar=mh.replace(/^v/,"").split("."),ho=+Ar[0]>10||+Ar[0]==10&&+Ar[1]>=12,si=ho?i=>K(i).mkdirSync===os.mkdirSync:()=>!1,as=Object.assign(ho?i=>K(i).mkdir===os.mkdir:()=>!1,{sync:si});var hs=(i,e)=>{i=Tr(i);let t=K(e);return si(t)?It(i,t):he(i,t)};var lo=Object.assign(async(i,e)=>{i=Tr(i);let t=K(e);return as(t)?ii(i,t):be(i,t)},{mkdirpSync:hs,mkdirpNative:ii,mkdirpNativeSync:It,mkdirpManual:be,mkdirpManualSync:he,sync:hs,native:ii,nativeSync:It,manual:be,manualSync:he,useNative:as,useNativeSync:si});var ai=O(require("node:path"),1);var ri=class extends Error{path;code;syscall="chdir";constructor(e,t){super(`${t}: Cannot cd into '${e}'`),this.path=e,this.code=t}get name(){return"CwdError"}};var ni=class extends Error{path;symlink;syscall="symlink";code="TAR_SYMLINK_ERROR";constructor(e,t){super("TAR_SYMLINK_ERROR: Cannot extract through symbolic link"),this.symlink=e,this.path=t}get name(){return"SymlinkError"}};var ls=(i,e)=>i.get(p(e)),oi=(i,e,t)=>i.set(p(e),t),ph=(i,e)=>{W.default.stat(i,(t,s)=>{(t||!s.isDirectory())&&(t=new ri(i,t?.code||"ENOTDIR")),e(t)})},co=(i,e,t)=>{i=p(i);let s=e.umask??18,r=e.mode|448,n=(r&s)!==0,o=e.uid,a=e.gid,h=typeof o=="number"&&typeof a=="number"&&(o!==e.processUid||a!==e.processGid),l=e.preserve,c=e.unlink,f=e.cache,u=p(e.cwd),m=(L,d)=>{L?t(L):(oi(f,i,!0),d&&h?gr(d,o,a,E=>m(E)):n?W.default.chmod(i,r,t):t())};if(f&&ls(f,i)===!0)return m();if(i===u)return ph(i,m);if(l)return lo(i,{mode:r}).then(L=>m(null,L??void 0),m);let _=p(ai.default.relative(u,i)).split("/");cs(u,_,r,f,c,u,void 0,m)},cs=(i,e,t,s,r,n,o,a)=>{if(!e.length)return a(null,o);let h=e.shift(),l=p(ai.default.resolve(i+"/"+h));if(ls(s,l))return cs(l,e,t,s,r,n,o,a);W.default.mkdir(l,t,fo(l,e,t,s,r,n,o,a))},fo=(i,e,t,s,r,n,o,a)=>h=>{h?W.default.lstat(i,(l,c)=>{if(l)l.path=l.path&&p(l.path),a(l);else if(c.isDirectory())cs(i,e,t,s,r,n,o,a);else if(r)W.default.unlink(i,f=>{if(f)return a(f);W.default.mkdir(i,t,fo(i,e,t,s,r,n,o,a))});else{if(c.isSymbolicLink())return a(new ni(i,i+"/"+e.join("/")));a(h)}}):(o=o||i,cs(i,e,t,s,r,n,o,a))},yh=i=>{let e=!1,t;try{e=W.default.statSync(i).isDirectory()}catch(s){t=s?.code}finally{if(!e)throw new ri(i,t??"ENOTDIR")}},uo=(i,e)=>{i=p(i);let t=e.umask??18,s=e.mode|448,r=(s&t)!==0,n=e.uid,o=e.gid,a=typeof n=="number"&&typeof o=="number"&&(n!==e.processUid||o!==e.processGid),h=e.preserve,l=e.unlink,c=e.cache,f=p(e.cwd),u=L=>{oi(c,i,!0),L&&a&&Sr(L,n,o),r&&W.default.chmodSync(i,s)};if(c&&ls(c,i)===!0)return u();if(i===f)return yh(f),u();if(h)return u(hs(i,s)??void 0);let w=p(ai.default.relative(f,i)).split("/"),_;for(let L=w.shift(),d=f;L&&(d+="/"+L);L=w.shift())if(d=p(ai.default.resolve(d)),!ls(c,d))try{W.default.mkdirSync(d,s),_=_||d,oi(c,d,!0)}catch{let S=W.default.lstatSync(d);if(S.isDirectory()){oi(c,d,!0);continue}else if(l){W.default.unlinkSync(d),W.default.mkdirSync(d,s),_=_||d,oi(c,d,!0);continue}else if(S.isSymbolicLink())return new ni(d,d+"/"+w.join("/"))}return u(_)};var Lr=Object.create(null),{hasOwnProperty:wh}=Object.prototype,fs=i=>(wh.call(Lr,i)||(Lr[i]=i.normalize("NFD")),Lr[i]);var Nr=require("node:path");var Eh=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,gh=Eh==="win32",Sh=i=>i.split("/").slice(0,-1).reduce((t,s)=>{let r=t[t.length-1];return r!==void 0&&(s=(0,Nr.join)(r,s)),t.push(s||"/"),t},[]),us=class{#e=new Map;#i=new Map;#s=new Set;reserve(e,t){e=gh?["win32 parallelization disabled"]:e.map(r=>oe((0,Nr.join)(fs(r))).toLowerCase());let s=new Set(e.map(r=>Sh(r)).reduce((r,n)=>r.concat(n)));this.#i.set(t,{dirs:s,paths:e});for(let r of e){let n=this.#e.get(r);n?n.push(t):this.#e.set(r,[t])}for(let r of s){let n=this.#e.get(r);if(!n)this.#e.set(r,[new Set([t])]);else{let o=n[n.length-1];o instanceof Set?o.add(t):n.push(new Set([t]))}}return this.#r(t)}#n(e){let t=this.#i.get(e);if(!t)throw new Error("function does not have any path reservations");return{paths:t.paths.map(s=>this.#e.get(s)),dirs:[...t.dirs].map(s=>this.#e.get(s))}}check(e){let{paths:t,dirs:s}=this.#n(e);return t.every(r=>r&&r[0]===e)&&s.every(r=>r&&r[0]instanceof Set&&r[0].has(e))}#r(e){return this.#s.has(e)||!this.check(e)?!1:(this.#s.add(e),e(()=>this.#t(e)),!0)}#t(e){if(!this.#s.has(e))return!1;let t=this.#i.get(e);if(!t)throw new Error("invalid reservation");let{paths:s,dirs:r}=t,n=new Set;for(let o of s){let a=this.#e.get(o);if(!a||a?.[0]!==e)continue;let h=a[1];if(!h){this.#e.delete(o);continue}if(a.shift(),typeof h=="function")n.add(h);else for(let l of h)n.add(l)}for(let o of r){let a=this.#e.get(o),h=a?.[0];if(!(!a||!(h instanceof Set)))if(h.size===1&&a.length===1){this.#e.delete(o);continue}else if(h.size===1){a.shift();let l=a[0];typeof l=="function"&&n.add(l)}else h.delete(e)}return this.#s.delete(e),n.forEach(o=>this.#r(o)),!0}};var mo=Symbol("onEntry"),Pr=Symbol("checkFs"),po=Symbol("checkFs2"),ps=Symbol("pruneCache"),Fr=Symbol("isReusable"),V=Symbol("makeFs"),Cr=Symbol("file"),vr=Symbol("directory"),ys=Symbol("link"),yo=Symbol("symlink"),wo=Symbol("hardlink"),Eo=Symbol("unsupported"),go=Symbol("checkPath"),Me=Symbol("mkdir"),B=Symbol("onError"),ds=Symbol("pending"),So=Symbol("pend"),Dt=Symbol("unpend"),Ir=Symbol("ended"),Dr=Symbol("maybeClose"),Br=Symbol("skip"),hi=Symbol("doChown"),li=Symbol("uid"),ci=Symbol("gid"),fi=Symbol("checkedCwd"),bh=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,ui=bh==="win32",Rh=1024,_h=(i,e)=>{if(!ui)return g.default.unlink(i,e);let t=i+".DELETE."+(0,kr.randomBytes)(16).toString("hex");g.default.rename(i,t,s=>{if(s)return e(s);g.default.unlink(t,e)})},Oh=i=>{if(!ui)return g.default.unlinkSync(i);let e=i+".DELETE."+(0,kr.randomBytes)(16).toString("hex");g.default.renameSync(i,e),g.default.unlinkSync(e)},bo=(i,e,t)=>i!==void 0&&i===i>>>0?i:e!==void 0&&e===e>>>0?e:t,Ro=i=>oe(p(fs(i))).toLowerCase(),xh=(i,e)=>{e=Ro(e);for(let t of i.keys()){let s=Ro(t);(s===e||s.indexOf(e+"/")===0)&&i.delete(t)}},Th=i=>{for(let e of i.keys())i.delete(e)},Pt=class extends Se{[Ir]=!1;[fi]=!1;[ds]=0;reservations=new us;transform;writable=!0;readable=!1;dirCache;uid;gid;setOwner;preserveOwner;processGid;processUid;maxDepth;forceChown;win32;newer;keep;noMtime;preservePaths;unlink;cwd;strip;processUmask;umask;dmode;fmode;chmod;constructor(e={}){if(e.ondone=()=>{this[Ir]=!0,this[Dr]()},super(e),this.transform=e.transform,this.dirCache=e.dirCache||new Map,this.chmod=!!e.chmod,typeof e.uid=="number"||typeof e.gid=="number"){if(typeof e.uid!="number"||typeof e.gid!="number")throw new TypeError("cannot set owner without number uid and gid");if(e.preserveOwner)throw new TypeError("cannot preserve owner in archive and also set owner explicitly");this.uid=e.uid,this.gid=e.gid,this.setOwner=!0}else this.uid=void 0,this.gid=void 0,this.setOwner=!1;e.preserveOwner===void 0&&typeof e.uid!="number"?this.preserveOwner=!!(process.getuid&&process.getuid()===0):this.preserveOwner=!!e.preserveOwner,this.processUid=(this.preserveOwner||this.setOwner)&&process.getuid?process.getuid():void 0,this.processGid=(this.preserveOwner||this.setOwner)&&process.getgid?process.getgid():void 0,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:Rh,this.forceChown=e.forceChown===!0,this.win32=!!e.win32||ui,this.newer=!!e.newer,this.keep=!!e.keep,this.noMtime=!!e.noMtime,this.preservePaths=!!e.preservePaths,this.unlink=!!e.unlink,this.cwd=p(le.default.resolve(e.cwd||process.cwd())),this.strip=Number(e.strip)||0,this.processUmask=this.chmod?typeof e.processUmask=="number"?e.processUmask:process.umask():0,this.umask=typeof e.umask=="number"?e.umask:this.processUmask,this.dmode=e.dmode||511&~this.umask,this.fmode=e.fmode||438&~this.umask,this.on("entry",t=>this[mo](t))}warn(e,t,s={}){return(e==="TAR_BAD_ARCHIVE"||e==="TAR_ABORT")&&(s.recoverable=!1),super.warn(e,t,s)}[Dr](){this[Ir]&&this[ds]===0&&(this.emit("prefinish"),this.emit("finish"),this.emit("end"))}[go](e){let t=p(e.path),s=t.split("/");if(this.strip){if(s.length<this.strip)return!1;if(e.type==="Link"){let r=p(String(e.linkpath)).split("/");if(r.length>=this.strip)e.linkpath=r.slice(this.strip).join("/");else return!1}s.splice(0,this.strip),e.path=s.join("/")}if(isFinite(this.maxDepth)&&s.length>this.maxDepth)return this.warn("TAR_ENTRY_ERROR","path excessively deep",{entry:e,path:t,depth:s.length,maxDepth:this.maxDepth}),!1;if(!this.preservePaths){if(s.includes("..")||ui&&/^[a-z]:\.\.$/i.test(s[0]??""))return this.warn("TAR_ENTRY_ERROR","path contains '..'",{entry:e,path:t}),!1;let[r,n]=Xt(t);r&&(e.path=String(n),this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:e,path:t}))}if(le.default.isAbsolute(e.path)?e.absolute=p(le.default.resolve(e.path)):e.absolute=p(le.default.resolve(this.cwd,e.path)),!this.preservePaths&&typeof e.absolute=="string"&&e.absolute.indexOf(this.cwd+"/")!==0&&e.absolute!==this.cwd)return this.warn("TAR_ENTRY_ERROR","path escaped extraction target",{entry:e,path:p(e.path),resolvedPath:e.absolute,cwd:this.cwd}),!1;if(e.absolute===this.cwd&&e.type!=="Directory"&&e.type!=="GNUDumpDir")return!1;if(this.win32){let{root:r}=le.default.win32.parse(String(e.absolute));e.absolute=r+Qs(String(e.absolute).slice(r.length));let{root:n}=le.default.win32.parse(e.path);e.path=n+Qs(e.path.slice(n.length))}return!0}[mo](e){if(!this[go](e))return e.resume();switch(_o.default.equal(typeof e.absolute,"string"),e.type){case"Directory":case"GNUDumpDir":e.mode&&(e.mode=e.mode|448);case"File":case"OldFile":case"ContiguousFile":case"Link":case"SymbolicLink":return this[Pr](e);case"CharacterDevice":case"BlockDevice":case"FIFO":default:return this[Eo](e)}}[B](e,t){e.name==="CwdError"?this.emit("error",e):(this.warn("TAR_ENTRY_ERROR",e,{entry:t}),this[Dt](),t.resume())}[Me](e,t,s){co(p(e),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:t},s)}[hi](e){return this.forceChown||this.preserveOwner&&(typeof e.uid=="number"&&e.uid!==this.processUid||typeof e.gid=="number"&&e.gid!==this.processGid)||typeof this.uid=="number"&&this.uid!==this.processUid||typeof this.gid=="number"&&this.gid!==this.processGid}[li](e){return bo(this.uid,e.uid,this.processUid)}[ci](e){return bo(this.gid,e.gid,this.processGid)}[Cr](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.fmode,r=new pe(String(e.absolute),{flags:wr(e.size),mode:s,autoClose:!1});r.on("error",h=>{r.fd&&g.default.close(r.fd,()=>{}),r.write=()=>!0,this[B](h,e),t()});let n=1,o=h=>{if(h){r.fd&&g.default.close(r.fd,()=>{}),this[B](h,e),t();return}--n===0&&r.fd!==void 0&&g.default.close(r.fd,l=>{l?this[B](l,e):this[Dt](),t()})};r.on("finish",()=>{let h=String(e.absolute),l=r.fd;if(typeof l=="number"&&e.mtime&&!this.noMtime){n++;let c=e.atime||new Date,f=e.mtime;g.default.futimes(l,c,f,u=>u?g.default.utimes(h,c,f,m=>o(m&&u)):o())}if(typeof l=="number"&&this[hi](e)){n++;let c=this[li](e),f=this[ci](e);typeof c=="number"&&typeof f=="number"&&g.default.fchown(l,c,f,u=>u?g.default.chown(h,c,f,m=>o(m&&u)):o())}o()});let a=this.transform&&this.transform(e)||e;a!==e&&(a.on("error",h=>{this[B](h,e),t()}),e.pipe(a)),a.pipe(r)}[vr](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.dmode;this[Me](String(e.absolute),s,r=>{if(r){this[B](r,e),t();return}let n=1,o=()=>{--n===0&&(t(),this[Dt](),e.resume())};e.mtime&&!this.noMtime&&(n++,g.default.utimes(String(e.absolute),e.atime||new Date,e.mtime,o)),this[hi](e)&&(n++,g.default.chown(String(e.absolute),Number(this[li](e)),Number(this[ci](e)),o)),o()})}[Eo](e){e.unsupported=!0,this.warn("TAR_ENTRY_UNSUPPORTED",`unsupported entry type: ${e.type}`,{entry:e}),e.resume()}[yo](e,t){this[ys](e,String(e.linkpath),"symlink",t)}[wo](e,t){let s=p(le.default.resolve(this.cwd,String(e.linkpath)));this[ys](e,s,"link",t)}[So](){this[ds]++}[Dt](){this[ds]--,this[Dr]()}[Br](e){this[Dt](),e.resume()}[Fr](e,t){return e.type==="File"&&!this.unlink&&t.isFile()&&t.nlink<=1&&!ui}[Pr](e){this[So]();let t=[e.path];e.linkpath&&t.push(e.linkpath),this.reservations.reserve(t,s=>this[po](e,s))}[ps](e){e.type==="SymbolicLink"?Th(this.dirCache):e.type!=="Directory"&&xh(this.dirCache,String(e.absolute))}[po](e,t){this[ps](e);let s=a=>{this[ps](e),t(a)},r=()=>{this[Me](this.cwd,this.dmode,a=>{if(a){this[B](a,e),s();return}this[fi]=!0,n()})},n=()=>{if(e.absolute!==this.cwd){let a=p(le.default.dirname(String(e.absolute)));if(a!==this.cwd)return this[Me](a,this.dmode,h=>{if(h){this[B](h,e),s();return}o()})}o()},o=()=>{g.default.lstat(String(e.absolute),(a,h)=>{if(h&&(this.keep||this.newer&&h.mtime>(e.mtime??h.mtime))){this[Br](e),s();return}if(a||this[Fr](e,h))return this[V](null,e,s);if(h.isDirectory()){if(e.type==="Directory"){let l=this.chmod&&e.mode&&(h.mode&4095)!==e.mode,c=f=>this[V](f??null,e,s);return l?g.default.chmod(String(e.absolute),Number(e.mode),c):c()}if(e.absolute!==this.cwd)return g.default.rmdir(String(e.absolute),l=>this[V](l??null,e,s))}if(e.absolute===this.cwd)return this[V](null,e,s);_h(String(e.absolute),l=>this[V](l??null,e,s))})};this[fi]?n():r()}[V](e,t,s){if(e){this[B](e,t),s();return}switch(t.type){case"File":case"OldFile":case"ContiguousFile":return this[Cr](t,s);case"Link":return this[wo](t,s);case"SymbolicLink":return this[yo](t,s);case"Directory":case"GNUDumpDir":return this[vr](t,s)}}[ys](e,t,s,r){g.default[s](t,String(e.absolute),n=>{n?this[B](n,e):(this[Dt](),e.resume()),r()})}},ms=i=>{try{return[null,i()]}catch(e){return[e,null]}},di=class extends Pt{sync=!0;[V](e,t){return super[V](e,t,()=>{})}[Pr](e){if(this[ps](e),!this[fi]){let n=this[Me](this.cwd,this.dmode);if(n)return this[B](n,e);this[fi]=!0}if(e.absolute!==this.cwd){let n=p(le.default.dirname(String(e.absolute)));if(n!==this.cwd){let o=this[Me](n,this.dmode);if(o)return this[B](o,e)}}let[t,s]=ms(()=>g.default.lstatSync(String(e.absolute)));if(s&&(this.keep||this.newer&&s.mtime>(e.mtime??s.mtime)))return this[Br](e);if(t||this[Fr](e,s))return this[V](null,e);if(s.isDirectory()){if(e.type==="Directory"){let o=this.chmod&&e.mode&&(s.mode&4095)!==e.mode,[a]=o?ms(()=>{g.default.chmodSync(String(e.absolute),Number(e.mode))}):[];return this[V](a,e)}let[n]=ms(()=>g.default.rmdirSync(String(e.absolute)));this[V](n,e)}let[r]=e.absolute===this.cwd?[]:ms(()=>Oh(String(e.absolute)));this[V](r,e)}[Cr](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.fmode,r=a=>{let h;try{g.default.closeSync(n)}catch(l){h=l}(a||h)&&this[B](a||h,e),t()},n;try{n=g.default.openSync(String(e.absolute),wr(e.size),s)}catch(a){return r(a)}let o=this.transform&&this.transform(e)||e;o!==e&&(o.on("error",a=>this[B](a,e)),e.pipe(o)),o.on("data",a=>{try{g.default.writeSync(n,a,0,a.length)}catch(h){r(h)}}),o.on("end",()=>{let a=null;if(e.mtime&&!this.noMtime){let h=e.atime||new Date,l=e.mtime;try{g.default.futimesSync(n,h,l)}catch(c){try{g.default.utimesSync(String(e.absolute),h,l)}catch{a=c}}}if(this[hi](e)){let h=this[li](e),l=this[ci](e);try{g.default.fchownSync(n,Number(h),Number(l))}catch(c){try{g.default.chownSync(String(e.absolute),Number(h),Number(l))}catch{a=a||c}}}r(a)})}[vr](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.dmode,r=this[Me](String(e.absolute),s);if(r){this[B](r,e),t();return}if(e.mtime&&!this.noMtime)try{g.default.utimesSync(String(e.absolute),e.atime||new Date,e.mtime)}catch{}if(this[hi](e))try{g.default.chownSync(String(e.absolute),Number(this[li](e)),Number(this[ci](e)))}catch{}t(),e.resume()}[Me](e,t){try{return uo(p(e),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:t})}catch(s){return s}}[ys](e,t,s,r){let n=`${s}Sync`;try{g.default[n](t,String(e.absolute)),r(),e.resume()}catch(o){return this[B](o,e)}}};var Ah=i=>{let e=new di(i),t=i.file,s=Mr.default.statSync(t),r=i.maxReadSize||16*1024*1024;new Li(t,{readSize:r,size:s.size}).pipe(e)},Lh=(i,e)=>{let t=new Pt(i),s=i.maxReadSize||16*1024*1024,r=i.file;return new Promise((o,a)=>{t.on("error",a),t.on("close",o),Mr.default.stat(r,(h,l)=>{if(h)a(h);else{let c=new Ke(r,{readSize:s,size:l.size});c.on("error",a),c.pipe(t)}})})},ws=re(Ah,Lh,i=>new di(i),i=>new Pt(i),(i,e)=>{e?.length&&Ys(i,e)});var z=O(require("node:fs"),1),Ur=O(require("node:path"),1);var Nh=(i,e)=>{let t=new st(i),s=!0,r,n;try{try{r=z.default.openSync(i.file,"r+")}catch(h){if(h?.code==="ENOENT")r=z.default.openSync(i.file,"w+");else throw h}let o=z.default.fstatSync(r),a=Buffer.alloc(512);e:for(n=0;n<o.size;n+=512){for(let c=0,f=0;c<512;c+=f){if(f=z.default.readSync(r,a,c,a.length-c,n+c),n===0&&a[0]===31&&a[1]===139)throw new Error("cannot append to compressed archives");if(!f)break e}let h=new $(a);if(!h.cksumValid)break;let l=512*Math.ceil((h.size||0)/512);if(n+l+512>o.size)break;n+=l,i.mtimeCache&&h.mtime&&i.mtimeCache.set(String(h.path),h.mtime)}s=!1,Ih(i,t,n,r,e)}finally{if(s)try{z.default.closeSync(r)}catch{}}},Ih=(i,e,t,s,r)=>{let n=new _t(i.file,{fd:s,start:t});e.pipe(n),Ph(e,r)},Dh=(i,e)=>{e=Array.from(e);let t=new Be(i),s=(n,o,a)=>{let h=(m,w)=>{m?z.default.close(n,_=>a(m)):a(null,w)},l=0;if(o===0)return h(null,0);let c=0,f=Buffer.alloc(512),u=(m,w)=>{if(m||typeof w>"u")return h(m);if(c+=w,c<512&&w)return z.default.read(n,f,c,f.length-c,l+c,u);if(l===0&&f[0]===31&&f[1]===139)return h(new Error("cannot append to compressed archives"));if(c<512)return h(null,l);let _=new $(f);if(!_.cksumValid)return h(null,l);let L=512*Math.ceil((_.size??0)/512);if(l+L+512>o||(l+=L+512,l>=o))return h(null,l);i.mtimeCache&&_.mtime&&i.mtimeCache.set(String(_.path),_.mtime),c=0,z.default.read(n,f,0,512,l,u)};z.default.read(n,f,0,512,l,u)};return new Promise((n,o)=>{t.on("error",o);let a="r+",h=(l,c)=>{if(l&&l.code==="ENOENT"&&a==="r+")return a="w+",z.default.open(i.file,a,h);if(l||!c)return o(l);z.default.fstat(c,(f,u)=>{if(f)return z.default.close(c,()=>o(f));s(c,u.size,(m,w)=>{if(m)return o(m);let _=new pe(i.file,{fd:c,start:w});t.pipe(_),_.on("error",o),_.on("close",n),Fh(t,e)})})};z.default.open(i.file,a,h)})},Ph=(i,e)=>{e.forEach(t=>{t.charAt(0)==="@"?tt({file:Ur.default.resolve(i.cwd,t.slice(1)),sync:!0,noResume:!0,onReadEntry:s=>i.add(s)}):i.add(t)}),i.end()},Fh=async(i,e)=>{for(let t=0;t<e.length;t++){let s=String(e[t]);s.charAt(0)==="@"?await tt({file:Ur.default.resolve(String(i.cwd),s.slice(1)),noResume:!0,onReadEntry:r=>i.add(r)}):i.add(s)}i.end()},rt=re(Nh,Dh,()=>{throw new TypeError("file is required")},()=>{throw new TypeError("file is required")},(i,e)=>{if(!Ln(i))throw new TypeError("file is required");if(i.gzip||i.brotli||i.file.endsWith(".br")||i.file.endsWith(".tbr"))throw new TypeError("cannot append to compressed archives");if(!e?.length)throw new TypeError("no paths specified to add/replace")});var Ch=re(rt.syncFile,rt.asyncFile,rt.syncNoFile,rt.asyncNoFile,(i,e=[])=>{rt.validate?.(i,e),vh(i)}),vh=i=>{let e=i.filter;i.mtimeCache||(i.mtimeCache=new Map),i.filter=e?(t,s)=>e(t,s)&&!((i.mtimeCache?.get(t)??s.mtime??0)>(s.mtime??0)):(t,s)=>!((i.mtimeCache?.get(t)??s.mtime??0)>(s.mtime??0))};var Io=require("os"),Do=require("path"),$r=require("crypto"),Lo=10*60,No=process.env.STAINLESS_POLL_WAIT_MS?parseInt(process.env.STAINLESS_POLL_WAIT_MS):5e3;function kh(){let i=Ao()(process.argv.slice(2),{string:["org-name","project-name","oas-path","config-path"],alias:{o:"org-name",p:"project-name",s:"oas-path",c:"config-path"}});(!i["org-name"]||!i["project-name"]||!i["oas-path"]||!i["config-path"])&&(console.error("Usage: node script.js --org-name <arg> --project-name <arg> --oas-path <arg> --config-path <arg> --output-<language>=<dir>"),process.exit(1));let e={};for(let[t,s]of Object.entries(i))if(t.startsWith("output-")){let r=t.replace("output-","");e[r]=s}return Object.keys(e).length===0&&(console.error("At least one output directory must be specified (--output-<language>=<dir>)"),process.exit(1)),{orgName:i["org-name"],projectName:i["project-name"],oasPath:i["oas-path"],configPath:i["config-path"],outputDirs:e}}async function Mh(){try{let i=kh();if(!process.env.STAINLESS_API_KEY)throw new Error("STAINLESS_API_KEY environment variable is required");if(!process.env.GITHUB_TOKEN)throw new Error("GITHUB_TOKEN environment variable is required");let{orgName:e,projectName:t,oasPath:s,configPath:r,outputDirs:n}=i,o=`cli/${(0,$r.randomBytes)(8).toString("hex")}`,a=new A({apiKey:process.env.STAINLESS_API_KEY,logLevel:"error"});console.log(`Creating a Stainless build for project ${t} with OpenAPI spec at ${s} and Stainless config at ${r}.`);let h;try{let[d,E]=await Promise.all([ze(nt.default.createReadStream(s),void 0,{type:"text/plain"}),ze(nt.default.createReadStream(r),void 0,{type:"text/plain"})]);h=await a.builds.create({projectName:t,oasSpec:d,stainlessConfig:E,branch:o}).asResponse()}catch(d){console.error("Build creation failed:",d),process.exit(1)}let l=h.headers.get("X-Stainless-Project-Build-ID"),c=h.headers.get("X-Stainless-Project-Build-Languages"),f=c?.length?c.split(","):[];l?console.log(`Build created with ID: ${l} in languages: ${f.join(", ")}`):(console.error("Build creation failed unexpectedly. Please contact support@stainless.com."),process.exit(0));let u=f.filter(d=>d in n),m=f.filter(d=>!(d in n));m.length&&console.warn(`No output directory specified for ${m.join(", ")}.`);let w=[],_=Date.now();for(;Object.keys(w).length<u.length&&Date.now()-_<Lo*1e3;){for(let E of u)if(!w.some(S=>S.language===E)){let S;try{S=await a.builds.outputs.retrieve(l,{target:E})}catch(y){console.error(`Failed to retrieve build output for ${E}:`,y);continue}if(S.commit.status==="completed"){let y=S.commit.completed;if(console.log(`Build completed for ${E}.`),"commit"in y){let T=`${t}-${E}`;console.log(`Downloading ${E} SDK to ${n[E]}`);try{await Uh({owner:"stainless-sdks",repo:T,branch:o,outputDir:n[E]}),w.push({language:E,conclusion:y.conclusion})}catch(j){console.error(`Failed to download files for ${E}:`,j),w.push({language:E,conclusion:"download_failed"})}}else w.push({language:E,conclusion:y.conclusion})}}let d=u.filter(E=>!w.some(S=>S.language===E));d.length&&(console.log(`Waiting for build to complete generation in ${d.join(", ")}. Polling again in ${No/1e3} seconds.`),await new Promise(E=>setTimeout(E,No)))}u.filter(d=>!w.some(E=>E.language===d)).forEach(d=>{console.error(`Build for ${d} did not complete within ${Lo} seconds.`),w.push({language:d,conclusion:"timed_out"})});let L=!0;for(let d of w){let E,S;["success","note"].includes(d.conclusion)?E=console.info:d.conclusion==="warning"?E=console.warn:E=console.error;let T=`For more details, visit the Stainless studio at ${`https://app.stainlessapi.com/${e}/${t}/studio?language=${d.language}&branch=${o}`}`;switch(d.conclusion){case"success":case"note":case"warning":case"error":S=`Build for ${d.language} completed with conclusion: "${d.conclusion}" and wrote an SDK in ${n[d.language]}. ${T}`;break;case"fatal":case"timed_out":case"download_failed":S=`Build for ${d.language} failed with conclusion: "${d.conclusion}". ${T}`,L=!1;default:S=`Build for ${d.language} had an unexpected conclusion: "${d.conclusion}". Please contact support@stainless.com.`,L=!1}E(S)}L?process.exit(0):process.exit(1)}catch(i){console.error("Error:",i),process.exit(1)}}async function Uh({owner:i,repo:e,branch:t,outputDir:s}){let r=`https://api.github.com/repos/${i}/${e}/tarball/${t}`,n=(0,Do.join)((0,Io.tmpdir)(),`${e}-${(0,$r.randomBytes)(8).toString("hex")}`);nt.default.mkdirSync(n,{recursive:!0});try{await new Promise((o,a)=>{let h=zr.default.get(r,{headers:{Authorization:`token ${process.env.GITHUB_TOKEN}`,"User-Agent":"stainless-build"}},l=>{l.statusCode===302&&l.headers.location?(h.abort(),zr.default.get(l.headers.location,c=>{c.pipe((0,Hr.createGunzip)()).pipe(ws({cwd:n,strip:1})).on("finish",o).on("error",a)}).on("error",a)):l.pipe((0,Hr.createGunzip)()).pipe(ws({cwd:n,strip:1})).on("finish",o).on("error",a)}).on("error",a)}),nt.default.rmSync(s,{recursive:!0,force:!0}),nt.default.cpSync(n,s,{force:!0,recursive:!0})}finally{nt.default.rmSync(n,{recursive:!0,force:!0})}}Mh();